var Ie=Object.defineProperty;var Ae=(k,E,w)=>E in k?Ie(k,E,{enumerable:!0,configurable:!0,writable:!0,value:w}):k[E]=w;var D=(k,E,w)=>Ae(k,typeof E!="symbol"?E+"":E,w);(function(){const E=document.createElement("link").relList;if(E&&E.supports&&E.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))I(u);new MutationObserver(u=>{for(const e of u)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&I(a)}).observe(document,{childList:!0,subtree:!0});function w(u){const e={};return u.integrity&&(e.integrity=u.integrity),u.referrerPolicy&&(e.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?e.credentials="include":u.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function I(u){if(u.ep)return;u.ep=!0;const e=w(u);fetch(u.href,e)}})();var ae=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},we={exports:{}};/*!
 * matter-js 0.19.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */(function(k,E){(function(I,u){k.exports=u()})(ae,function(){return function(w){var I={};function u(e){if(I[e])return I[e].exports;var a=I[e]={i:e,l:!1,exports:{}};return w[e].call(a.exports,a,a.exports,u),a.l=!0,a.exports}return u.m=w,u.c=I,u.d=function(e,a,n){u.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:n})},u.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,a){if(a&1&&(e=u(e)),a&8||a&4&&typeof e=="object"&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),a&2&&typeof e!="string")for(var s in e)u.d(n,s,(function(h){return e[h]}).bind(null,s));return n},u.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return u.d(a,"a",a),a},u.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},u.p="",u(u.s=20)}([function(w,I){var u={};w.exports=u,function(){u._baseDelta=1e3/60,u._nextId=0,u._seed=0,u._nowStartTime=+new Date,u._warnedOnce={},u._decomp=null,u.extend=function(a,n){var s,h;typeof n=="boolean"?(s=2,h=n):(s=1,h=!0);for(var l=s;l<arguments.length;l++){var f=arguments[l];if(f)for(var o in f)h&&f[o]&&f[o].constructor===Object&&(!a[o]||a[o].constructor===Object)?(a[o]=a[o]||{},u.extend(a[o],h,f[o])):a[o]=f[o]}return a},u.clone=function(a,n){return u.extend({},n,a)},u.keys=function(a){if(Object.keys)return Object.keys(a);var n=[];for(var s in a)n.push(s);return n},u.values=function(a){var n=[];if(Object.keys){for(var s=Object.keys(a),h=0;h<s.length;h++)n.push(a[s[h]]);return n}for(var l in a)n.push(a[l]);return n},u.get=function(a,n,s,h){n=n.split(".").slice(s,h);for(var l=0;l<n.length;l+=1)a=a[n[l]];return a},u.set=function(a,n,s,h,l){var f=n.split(".").slice(h,l);return u.get(a,n,0,-1)[f[f.length-1]]=s,s},u.shuffle=function(a){for(var n=a.length-1;n>0;n--){var s=Math.floor(u.random()*(n+1)),h=a[n];a[n]=a[s],a[s]=h}return a},u.choose=function(a){return a[Math.floor(u.random()*a.length)]},u.isElement=function(a){return typeof HTMLElement<"u"?a instanceof HTMLElement:!!(a&&a.nodeType&&a.nodeName)},u.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"},u.isFunction=function(a){return typeof a=="function"},u.isPlainObject=function(a){return typeof a=="object"&&a.constructor===Object},u.isString=function(a){return toString.call(a)==="[object String]"},u.clamp=function(a,n,s){return a<n?n:a>s?s:a},u.sign=function(a){return a<0?-1:1},u.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-u._nowStartTime},u.random=function(a,n){return a=typeof a<"u"?a:0,n=typeof n<"u"?n:1,a+e()*(n-a)};var e=function(){return u._seed=(u._seed*9301+49297)%233280,u._seed/233280};u.colorToNumber=function(a){return a=a.replace("#",""),a.length==3&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),parseInt(a,16)},u.logLevel=1,u.log=function(){console&&u.logLevel>0&&u.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},u.info=function(){console&&u.logLevel>0&&u.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},u.warn=function(){console&&u.logLevel>0&&u.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},u.warnOnce=function(){var a=Array.prototype.slice.call(arguments).join(" ");u._warnedOnce[a]||(u.warn(a),u._warnedOnce[a]=!0)},u.deprecated=function(a,n,s){a[n]=u.chain(function(){u.warnOnce("🔅 deprecated 🔅",s)},a[n])},u.nextId=function(){return u._nextId++},u.indexOf=function(a,n){if(a.indexOf)return a.indexOf(n);for(var s=0;s<a.length;s++)if(a[s]===n)return s;return-1},u.map=function(a,n){if(a.map)return a.map(n);for(var s=[],h=0;h<a.length;h+=1)s.push(n(a[h]));return s},u.topologicalSort=function(a){var n=[],s=[],h=[];for(var l in a)!s[l]&&!h[l]&&u._topologicalSort(l,s,h,a,n);return n},u._topologicalSort=function(a,n,s,h,l){var f=h[a]||[];s[a]=!0;for(var o=0;o<f.length;o+=1){var t=f[o];s[t]||n[t]||u._topologicalSort(t,n,s,h,l)}s[a]=!1,n[a]=!0,l.push(a)},u.chain=function(){for(var a=[],n=0;n<arguments.length;n+=1){var s=arguments[n];s._chained?a.push.apply(a,s._chained):a.push(s)}var h=function(){for(var l,f=new Array(arguments.length),o=0,t=arguments.length;o<t;o++)f[o]=arguments[o];for(o=0;o<a.length;o+=1){var i=a[o].apply(l,f);typeof i<"u"&&(l=i)}return l};return h._chained=a,h},u.chainPathBefore=function(a,n,s){return u.set(a,n,u.chain(s,u.get(a,n)))},u.chainPathAfter=function(a,n,s){return u.set(a,n,u.chain(u.get(a,n),s))},u.setDecomp=function(a){u._decomp=a},u.getDecomp=function(){var a=u._decomp;try{!a&&typeof window<"u"&&(a=window.decomp),!a&&typeof ae<"u"&&(a=ae.decomp)}catch{a=null}return a}}()},function(w,I){var u={};w.exports=u,function(){u.create=function(e){var a={min:{x:0,y:0},max:{x:0,y:0}};return e&&u.update(a,e),a},u.update=function(e,a,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var s=0;s<a.length;s++){var h=a[s];h.x>e.max.x&&(e.max.x=h.x),h.x<e.min.x&&(e.min.x=h.x),h.y>e.max.y&&(e.max.y=h.y),h.y<e.min.y&&(e.min.y=h.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},u.contains=function(e,a){return a.x>=e.min.x&&a.x<=e.max.x&&a.y>=e.min.y&&a.y<=e.max.y},u.overlaps=function(e,a){return e.min.x<=a.max.x&&e.max.x>=a.min.x&&e.max.y>=a.min.y&&e.min.y<=a.max.y},u.translate=function(e,a){e.min.x+=a.x,e.max.x+=a.x,e.min.y+=a.y,e.max.y+=a.y},u.shift=function(e,a){var n=e.max.x-e.min.x,s=e.max.y-e.min.y;e.min.x=a.x,e.max.x=a.x+n,e.min.y=a.y,e.max.y=a.y+s}}()},function(w,I){var u={};w.exports=u,function(){u.create=function(e,a){return{x:e||0,y:a||0}},u.clone=function(e){return{x:e.x,y:e.y}},u.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},u.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},u.rotate=function(e,a,n){var s=Math.cos(a),h=Math.sin(a);n||(n={});var l=e.x*s-e.y*h;return n.y=e.x*h+e.y*s,n.x=l,n},u.rotateAbout=function(e,a,n,s){var h=Math.cos(a),l=Math.sin(a);s||(s={});var f=n.x+((e.x-n.x)*h-(e.y-n.y)*l);return s.y=n.y+((e.x-n.x)*l+(e.y-n.y)*h),s.x=f,s},u.normalise=function(e){var a=u.magnitude(e);return a===0?{x:0,y:0}:{x:e.x/a,y:e.y/a}},u.dot=function(e,a){return e.x*a.x+e.y*a.y},u.cross=function(e,a){return e.x*a.y-e.y*a.x},u.cross3=function(e,a,n){return(a.x-e.x)*(n.y-e.y)-(a.y-e.y)*(n.x-e.x)},u.add=function(e,a,n){return n||(n={}),n.x=e.x+a.x,n.y=e.y+a.y,n},u.sub=function(e,a,n){return n||(n={}),n.x=e.x-a.x,n.y=e.y-a.y,n},u.mult=function(e,a){return{x:e.x*a,y:e.y*a}},u.div=function(e,a){return{x:e.x/a,y:e.y/a}},u.perp=function(e,a){return a=a===!0?-1:1,{x:a*-e.y,y:a*e.x}},u.neg=function(e){return{x:-e.x,y:-e.y}},u.angle=function(e,a){return Math.atan2(a.y-e.y,a.x-e.x)},u._temp=[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()]}()},function(w,I,u){var e={};w.exports=e;var a=u(2),n=u(0);(function(){e.create=function(s,h){for(var l=[],f=0;f<s.length;f++){var o=s[f],t={x:o.x,y:o.y,index:f,body:h,isInternal:!1};l.push(t)}return l},e.fromPath=function(s,h){var l=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,f=[];return s.replace(l,function(o,t,i){f.push({x:parseFloat(t),y:parseFloat(i)})}),e.create(f,h)},e.centre=function(s){for(var h=e.area(s,!0),l={x:0,y:0},f,o,t,i=0;i<s.length;i++)t=(i+1)%s.length,f=a.cross(s[i],s[t]),o=a.mult(a.add(s[i],s[t]),f),l=a.add(l,o);return a.div(l,6*h)},e.mean=function(s){for(var h={x:0,y:0},l=0;l<s.length;l++)h.x+=s[l].x,h.y+=s[l].y;return a.div(h,s.length)},e.area=function(s,h){for(var l=0,f=s.length-1,o=0;o<s.length;o++)l+=(s[f].x-s[o].x)*(s[f].y+s[o].y),f=o;return h?l/2:Math.abs(l)/2},e.inertia=function(s,h){for(var l=0,f=0,o=s,t,i,r=0;r<o.length;r++)i=(r+1)%o.length,t=Math.abs(a.cross(o[i],o[r])),l+=t*(a.dot(o[i],o[i])+a.dot(o[i],o[r])+a.dot(o[r],o[r])),f+=t;return h/6*(l/f)},e.translate=function(s,h,l){l=typeof l<"u"?l:1;var f=s.length,o=h.x*l,t=h.y*l,i;for(i=0;i<f;i++)s[i].x+=o,s[i].y+=t;return s},e.rotate=function(s,h,l){if(h!==0){var f=Math.cos(h),o=Math.sin(h),t=l.x,i=l.y,r=s.length,c,g,y,C;for(C=0;C<r;C++)c=s[C],g=c.x-t,y=c.y-i,c.x=t+(g*f-y*o),c.y=i+(g*o+y*f);return s}},e.contains=function(s,h){for(var l=h.x,f=h.y,o=s.length,t=s[o-1],i,r=0;r<o;r++){if(i=s[r],(l-t.x)*(i.y-t.y)+(f-t.y)*(t.x-i.x)>0)return!1;t=i}return!0},e.scale=function(s,h,l,f){if(h===1&&l===1)return s;f=f||e.centre(s);for(var o,t,i=0;i<s.length;i++)o=s[i],t=a.sub(o,f),s[i].x=f.x+t.x*h,s[i].y=f.y+t.y*l;return s},e.chamfer=function(s,h,l,f,o){typeof h=="number"?h=[h]:h=h||[8],l=typeof l<"u"?l:-1,f=f||2,o=o||14;for(var t=[],i=0;i<s.length;i++){var r=s[i-1>=0?i-1:s.length-1],c=s[i],g=s[(i+1)%s.length],y=h[i<h.length?i:h.length-1];if(y===0){t.push(c);continue}var C=a.normalise({x:c.y-r.y,y:r.x-c.x}),M=a.normalise({x:g.y-c.y,y:c.x-g.x}),v=Math.sqrt(2*Math.pow(y,2)),p=a.mult(n.clone(C),y),m=a.normalise(a.mult(a.add(C,M),.5)),d=a.sub(c,a.mult(m,v)),S=l;l===-1&&(S=Math.pow(y,.32)*1.75),S=n.clamp(S,f,o),S%2===1&&(S+=1);for(var x=Math.acos(a.dot(C,M)),T=x/S,P=0;P<S;P++)t.push(a.add(a.rotate(p,T*P),d))}return t},e.clockwiseSort=function(s){var h=e.mean(s);return s.sort(function(l,f){return a.angle(h,l)-a.angle(h,f)}),s},e.isConvex=function(s){var h=0,l=s.length,f,o,t,i;if(l<3)return null;for(f=0;f<l;f++)if(o=(f+1)%l,t=(f+2)%l,i=(s[o].x-s[f].x)*(s[t].y-s[o].y),i-=(s[o].y-s[f].y)*(s[t].x-s[o].x),i<0?h|=1:i>0&&(h|=2),h===3)return!1;return h!==0?!0:null},e.hull=function(s){var h=[],l=[],f,o;for(s=s.slice(0),s.sort(function(t,i){var r=t.x-i.x;return r!==0?r:t.y-i.y}),o=0;o<s.length;o+=1){for(f=s[o];l.length>=2&&a.cross3(l[l.length-2],l[l.length-1],f)<=0;)l.pop();l.push(f)}for(o=s.length-1;o>=0;o-=1){for(f=s[o];h.length>=2&&a.cross3(h[h.length-2],h[h.length-1],f)<=0;)h.pop();h.push(f)}return h.pop(),l.pop(),h.concat(l)}})()},function(w,I,u){var e={};w.exports=e;var a=u(3),n=u(2),s=u(7),h=u(0),l=u(1),f=u(11);(function(){e._timeCorrection=!0,e._inertiaScale=4,e._nextCollidingGroupId=1,e._nextNonCollidingGroupId=-1,e._nextCategory=1,e._baseDelta=1e3/60,e.create=function(t){var i={id:h.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:a.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},r=h.extend(i,t);return o(r,t),r},e.nextGroup=function(t){return t?e._nextNonCollidingGroupId--:e._nextCollidingGroupId++},e.nextCategory=function(){return e._nextCategory=e._nextCategory<<1,e._nextCategory};var o=function(t,i){i=i||{},e.set(t,{bounds:t.bounds||l.create(t.vertices),positionPrev:t.positionPrev||n.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),a.rotate(t.vertices,t.angle,t.position),f.rotate(t.axes,t.angle),l.update(t.bounds,t.vertices,t.velocity),e.set(t,{axes:i.axes||t.axes,area:i.area||t.area,mass:i.mass||t.mass,inertia:i.inertia||t.inertia});var r=t.isStatic?"#14151f":h.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),c=t.isStatic?"#555":"#ccc",g=t.isStatic&&t.render.fillStyle===null?1:0;t.render.fillStyle=t.render.fillStyle||r,t.render.strokeStyle=t.render.strokeStyle||c,t.render.lineWidth=t.render.lineWidth||g,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};e.set=function(t,i,r){var c;typeof i=="string"&&(c=i,i={},i[c]=r);for(c in i)if(Object.prototype.hasOwnProperty.call(i,c))switch(r=i[c],c){case"isStatic":e.setStatic(t,r);break;case"isSleeping":s.set(t,r);break;case"mass":e.setMass(t,r);break;case"density":e.setDensity(t,r);break;case"inertia":e.setInertia(t,r);break;case"vertices":e.setVertices(t,r);break;case"position":e.setPosition(t,r);break;case"angle":e.setAngle(t,r);break;case"velocity":e.setVelocity(t,r);break;case"angularVelocity":e.setAngularVelocity(t,r);break;case"speed":e.setSpeed(t,r);break;case"angularSpeed":e.setAngularSpeed(t,r);break;case"parts":e.setParts(t,r);break;case"centre":e.setCentre(t,r);break;default:t[c]=r}},e.setStatic=function(t,i){for(var r=0;r<t.parts.length;r++){var c=t.parts[r];c.isStatic=i,i?(c._original={restitution:c.restitution,friction:c.friction,mass:c.mass,inertia:c.inertia,density:c.density,inverseMass:c.inverseMass,inverseInertia:c.inverseInertia},c.restitution=0,c.friction=1,c.mass=c.inertia=c.density=1/0,c.inverseMass=c.inverseInertia=0,c.positionPrev.x=c.position.x,c.positionPrev.y=c.position.y,c.anglePrev=c.angle,c.angularVelocity=0,c.speed=0,c.angularSpeed=0,c.motion=0):c._original&&(c.restitution=c._original.restitution,c.friction=c._original.friction,c.mass=c._original.mass,c.inertia=c._original.inertia,c.density=c._original.density,c.inverseMass=c._original.inverseMass,c.inverseInertia=c._original.inverseInertia,c._original=null)}},e.setMass=function(t,i){var r=t.inertia/(t.mass/6);t.inertia=r*(i/6),t.inverseInertia=1/t.inertia,t.mass=i,t.inverseMass=1/t.mass,t.density=t.mass/t.area},e.setDensity=function(t,i){e.setMass(t,i*t.area),t.density=i},e.setInertia=function(t,i){t.inertia=i,t.inverseInertia=1/t.inertia},e.setVertices=function(t,i){i[0].body===t?t.vertices=i:t.vertices=a.create(i,t),t.axes=f.fromVertices(t.vertices),t.area=a.area(t.vertices),e.setMass(t,t.density*t.area);var r=a.centre(t.vertices);a.translate(t.vertices,r,-1),e.setInertia(t,e._inertiaScale*a.inertia(t.vertices,t.mass)),a.translate(t.vertices,t.position),l.update(t.bounds,t.vertices,t.velocity)},e.setParts=function(t,i,r){var c;for(i=i.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,c=0;c<i.length;c++){var g=i[c];g!==t&&(g.parent=t,t.parts.push(g))}if(t.parts.length!==1){if(r=typeof r<"u"?r:!0,r){var y=[];for(c=0;c<i.length;c++)y=y.concat(i[c].vertices);a.clockwiseSort(y);var C=a.hull(y),M=a.centre(C);e.setVertices(t,C),a.translate(t.vertices,M)}var v=e._totalProperties(t);t.area=v.area,t.parent=t,t.position.x=v.centre.x,t.position.y=v.centre.y,t.positionPrev.x=v.centre.x,t.positionPrev.y=v.centre.y,e.setMass(t,v.mass),e.setInertia(t,v.inertia),e.setPosition(t,v.centre)}},e.setCentre=function(t,i,r){r?(t.positionPrev.x+=i.x,t.positionPrev.y+=i.y,t.position.x+=i.x,t.position.y+=i.y):(t.positionPrev.x=i.x-(t.position.x-t.positionPrev.x),t.positionPrev.y=i.y-(t.position.y-t.positionPrev.y),t.position.x=i.x,t.position.y=i.y)},e.setPosition=function(t,i,r){var c=n.sub(i,t.position);r?(t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.velocity.x=c.x,t.velocity.y=c.y,t.speed=n.magnitude(c)):(t.positionPrev.x+=c.x,t.positionPrev.y+=c.y);for(var g=0;g<t.parts.length;g++){var y=t.parts[g];y.position.x+=c.x,y.position.y+=c.y,a.translate(y.vertices,c),l.update(y.bounds,y.vertices,t.velocity)}},e.setAngle=function(t,i,r){var c=i-t.angle;r?(t.anglePrev=t.angle,t.angularVelocity=c,t.angularSpeed=Math.abs(c)):t.anglePrev+=c;for(var g=0;g<t.parts.length;g++){var y=t.parts[g];y.angle+=c,a.rotate(y.vertices,c,t.position),f.rotate(y.axes,c),l.update(y.bounds,y.vertices,t.velocity),g>0&&n.rotateAbout(y.position,c,t.position,y.position)}},e.setVelocity=function(t,i){var r=t.deltaTime/e._baseDelta;t.positionPrev.x=t.position.x-i.x*r,t.positionPrev.y=t.position.y-i.y*r,t.velocity.x=(t.position.x-t.positionPrev.x)/r,t.velocity.y=(t.position.y-t.positionPrev.y)/r,t.speed=n.magnitude(t.velocity)},e.getVelocity=function(t){var i=e._baseDelta/t.deltaTime;return{x:(t.position.x-t.positionPrev.x)*i,y:(t.position.y-t.positionPrev.y)*i}},e.getSpeed=function(t){return n.magnitude(e.getVelocity(t))},e.setSpeed=function(t,i){e.setVelocity(t,n.mult(n.normalise(e.getVelocity(t)),i))},e.setAngularVelocity=function(t,i){var r=t.deltaTime/e._baseDelta;t.anglePrev=t.angle-i*r,t.angularVelocity=(t.angle-t.anglePrev)/r,t.angularSpeed=Math.abs(t.angularVelocity)},e.getAngularVelocity=function(t){return(t.angle-t.anglePrev)*e._baseDelta/t.deltaTime},e.getAngularSpeed=function(t){return Math.abs(e.getAngularVelocity(t))},e.setAngularSpeed=function(t,i){e.setAngularVelocity(t,h.sign(e.getAngularVelocity(t))*i)},e.translate=function(t,i,r){e.setPosition(t,n.add(t.position,i),r)},e.rotate=function(t,i,r,c){if(!r)e.setAngle(t,t.angle+i,c);else{var g=Math.cos(i),y=Math.sin(i),C=t.position.x-r.x,M=t.position.y-r.y;e.setPosition(t,{x:r.x+(C*g-M*y),y:r.y+(C*y+M*g)},c),e.setAngle(t,t.angle+i,c)}},e.scale=function(t,i,r,c){var g=0,y=0;c=c||t.position;for(var C=0;C<t.parts.length;C++){var M=t.parts[C];a.scale(M.vertices,i,r,c),M.axes=f.fromVertices(M.vertices),M.area=a.area(M.vertices),e.setMass(M,t.density*M.area),a.translate(M.vertices,{x:-M.position.x,y:-M.position.y}),e.setInertia(M,e._inertiaScale*a.inertia(M.vertices,M.mass)),a.translate(M.vertices,{x:M.position.x,y:M.position.y}),C>0&&(g+=M.area,y+=M.inertia),M.position.x=c.x+(M.position.x-c.x)*i,M.position.y=c.y+(M.position.y-c.y)*r,l.update(M.bounds,M.vertices,t.velocity)}t.parts.length>1&&(t.area=g,t.isStatic||(e.setMass(t,t.density*g),e.setInertia(t,y))),t.circleRadius&&(i===r?t.circleRadius*=i:t.circleRadius=null)},e.update=function(t,i){i=(typeof i<"u"?i:1e3/60)*t.timeScale;var r=i*i,c=e._timeCorrection?i/(t.deltaTime||i):1,g=1-t.frictionAir*(i/h._baseDelta),y=(t.position.x-t.positionPrev.x)*c,C=(t.position.y-t.positionPrev.y)*c;t.velocity.x=y*g+t.force.x/t.mass*r,t.velocity.y=C*g+t.force.y/t.mass*r,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.deltaTime=i,t.angularVelocity=(t.angle-t.anglePrev)*g*c+t.torque/t.inertia*r,t.anglePrev=t.angle,t.angle+=t.angularVelocity;for(var M=0;M<t.parts.length;M++){var v=t.parts[M];a.translate(v.vertices,t.velocity),M>0&&(v.position.x+=t.velocity.x,v.position.y+=t.velocity.y),t.angularVelocity!==0&&(a.rotate(v.vertices,t.angularVelocity,t.position),f.rotate(v.axes,t.angularVelocity),M>0&&n.rotateAbout(v.position,t.angularVelocity,t.position,v.position)),l.update(v.bounds,v.vertices,t.velocity)}},e.updateVelocities=function(t){var i=e._baseDelta/t.deltaTime,r=t.velocity;r.x=(t.position.x-t.positionPrev.x)*i,r.y=(t.position.y-t.positionPrev.y)*i,t.speed=Math.sqrt(r.x*r.x+r.y*r.y),t.angularVelocity=(t.angle-t.anglePrev)*i,t.angularSpeed=Math.abs(t.angularVelocity)},e.applyForce=function(t,i,r){var c={x:i.x-t.position.x,y:i.y-t.position.y};t.force.x+=r.x,t.force.y+=r.y,t.torque+=c.x*r.y-c.y*r.x},e._totalProperties=function(t){for(var i={mass:0,area:0,inertia:0,centre:{x:0,y:0}},r=t.parts.length===1?0:1;r<t.parts.length;r++){var c=t.parts[r],g=c.mass!==1/0?c.mass:1;i.mass+=g,i.area+=c.area,i.inertia+=c.inertia,i.centre=n.add(i.centre,n.mult(c.position,g))}return i.centre=n.div(i.centre,i.mass),i}})()},function(w,I,u){var e={};w.exports=e;var a=u(0);(function(){e.on=function(n,s,h){for(var l=s.split(" "),f,o=0;o<l.length;o++)f=l[o],n.events=n.events||{},n.events[f]=n.events[f]||[],n.events[f].push(h);return h},e.off=function(n,s,h){if(!s){n.events={};return}typeof s=="function"&&(h=s,s=a.keys(n.events).join(" "));for(var l=s.split(" "),f=0;f<l.length;f++){var o=n.events[l[f]],t=[];if(h&&o)for(var i=0;i<o.length;i++)o[i]!==h&&t.push(o[i]);n.events[l[f]]=t}},e.trigger=function(n,s,h){var l,f,o,t,i=n.events;if(i&&a.keys(i).length>0){h||(h={}),l=s.split(" ");for(var r=0;r<l.length;r++)if(f=l[r],o=i[f],o){t=a.clone(h,!1),t.name=f,t.source=n;for(var c=0;c<o.length;c++)o[c].apply(n,[t])}}}})()},function(w,I,u){var e={};w.exports=e;var a=u(5),n=u(0),s=u(1),h=u(4);(function(){e.create=function(l){return n.extend({id:n.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},l)},e.setModified=function(l,f,o,t){if(l.isModified=f,f&&l.cache&&(l.cache.allBodies=null,l.cache.allConstraints=null,l.cache.allComposites=null),o&&l.parent&&e.setModified(l.parent,f,o,t),t)for(var i=0;i<l.composites.length;i++){var r=l.composites[i];e.setModified(r,f,o,t)}},e.add=function(l,f){var o=[].concat(f);a.trigger(l,"beforeAdd",{object:f});for(var t=0;t<o.length;t++){var i=o[t];switch(i.type){case"body":if(i.parent!==i){n.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}e.addBody(l,i);break;case"constraint":e.addConstraint(l,i);break;case"composite":e.addComposite(l,i);break;case"mouseConstraint":e.addConstraint(l,i.constraint);break}}return a.trigger(l,"afterAdd",{object:f}),l},e.remove=function(l,f,o){var t=[].concat(f);a.trigger(l,"beforeRemove",{object:f});for(var i=0;i<t.length;i++){var r=t[i];switch(r.type){case"body":e.removeBody(l,r,o);break;case"constraint":e.removeConstraint(l,r,o);break;case"composite":e.removeComposite(l,r,o);break;case"mouseConstraint":e.removeConstraint(l,r.constraint);break}}return a.trigger(l,"afterRemove",{object:f}),l},e.addComposite=function(l,f){return l.composites.push(f),f.parent=l,e.setModified(l,!0,!0,!1),l},e.removeComposite=function(l,f,o){var t=n.indexOf(l.composites,f);if(t!==-1&&e.removeCompositeAt(l,t),o)for(var i=0;i<l.composites.length;i++)e.removeComposite(l.composites[i],f,!0);return l},e.removeCompositeAt=function(l,f){return l.composites.splice(f,1),e.setModified(l,!0,!0,!1),l},e.addBody=function(l,f){return l.bodies.push(f),e.setModified(l,!0,!0,!1),l},e.removeBody=function(l,f,o){var t=n.indexOf(l.bodies,f);if(t!==-1&&e.removeBodyAt(l,t),o)for(var i=0;i<l.composites.length;i++)e.removeBody(l.composites[i],f,!0);return l},e.removeBodyAt=function(l,f){return l.bodies.splice(f,1),e.setModified(l,!0,!0,!1),l},e.addConstraint=function(l,f){return l.constraints.push(f),e.setModified(l,!0,!0,!1),l},e.removeConstraint=function(l,f,o){var t=n.indexOf(l.constraints,f);if(t!==-1&&e.removeConstraintAt(l,t),o)for(var i=0;i<l.composites.length;i++)e.removeConstraint(l.composites[i],f,!0);return l},e.removeConstraintAt=function(l,f){return l.constraints.splice(f,1),e.setModified(l,!0,!0,!1),l},e.clear=function(l,f,o){if(o)for(var t=0;t<l.composites.length;t++)e.clear(l.composites[t],f,!0);return f?l.bodies=l.bodies.filter(function(i){return i.isStatic}):l.bodies.length=0,l.constraints.length=0,l.composites.length=0,e.setModified(l,!0,!0,!1),l},e.allBodies=function(l){if(l.cache&&l.cache.allBodies)return l.cache.allBodies;for(var f=[].concat(l.bodies),o=0;o<l.composites.length;o++)f=f.concat(e.allBodies(l.composites[o]));return l.cache&&(l.cache.allBodies=f),f},e.allConstraints=function(l){if(l.cache&&l.cache.allConstraints)return l.cache.allConstraints;for(var f=[].concat(l.constraints),o=0;o<l.composites.length;o++)f=f.concat(e.allConstraints(l.composites[o]));return l.cache&&(l.cache.allConstraints=f),f},e.allComposites=function(l){if(l.cache&&l.cache.allComposites)return l.cache.allComposites;for(var f=[].concat(l.composites),o=0;o<l.composites.length;o++)f=f.concat(e.allComposites(l.composites[o]));return l.cache&&(l.cache.allComposites=f),f},e.get=function(l,f,o){var t,i;switch(o){case"body":t=e.allBodies(l);break;case"constraint":t=e.allConstraints(l);break;case"composite":t=e.allComposites(l).concat(l);break}return t?(i=t.filter(function(r){return r.id.toString()===f.toString()}),i.length===0?null:i[0]):null},e.move=function(l,f,o){return e.remove(l,f),e.add(o,f),l},e.rebase=function(l){for(var f=e.allBodies(l).concat(e.allConstraints(l)).concat(e.allComposites(l)),o=0;o<f.length;o++)f[o].id=n.nextId();return l},e.translate=function(l,f,o){for(var t=o?e.allBodies(l):l.bodies,i=0;i<t.length;i++)h.translate(t[i],f);return l},e.rotate=function(l,f,o,t){for(var i=Math.cos(f),r=Math.sin(f),c=t?e.allBodies(l):l.bodies,g=0;g<c.length;g++){var y=c[g],C=y.position.x-o.x,M=y.position.y-o.y;h.setPosition(y,{x:o.x+(C*i-M*r),y:o.y+(C*r+M*i)}),h.rotate(y,f)}return l},e.scale=function(l,f,o,t,i){for(var r=i?e.allBodies(l):l.bodies,c=0;c<r.length;c++){var g=r[c],y=g.position.x-t.x,C=g.position.y-t.y;h.setPosition(g,{x:t.x+y*f,y:t.y+C*o}),h.scale(g,f,o)}return l},e.bounds=function(l){for(var f=e.allBodies(l),o=[],t=0;t<f.length;t+=1){var i=f[t];o.push(i.bounds.min,i.bounds.max)}return s.create(o)}})()},function(w,I,u){var e={};w.exports=e;var a=u(4),n=u(5),s=u(0);(function(){e._motionWakeThreshold=.18,e._motionSleepThreshold=.08,e._minBias=.9,e.update=function(h,l){for(var f=l/s._baseDelta,o=e._motionSleepThreshold,t=0;t<h.length;t++){var i=h[t],r=a.getSpeed(i),c=a.getAngularSpeed(i),g=r*r+c*c;if(i.force.x!==0||i.force.y!==0){e.set(i,!1);continue}var y=Math.min(i.motion,g),C=Math.max(i.motion,g);i.motion=e._minBias*y+(1-e._minBias)*C,i.sleepThreshold>0&&i.motion<o?(i.sleepCounter+=1,i.sleepCounter>=i.sleepThreshold/f&&e.set(i,!0)):i.sleepCounter>0&&(i.sleepCounter-=1)}},e.afterCollisions=function(h){for(var l=e._motionSleepThreshold,f=0;f<h.length;f++){var o=h[f];if(o.isActive){var t=o.collision,i=t.bodyA.parent,r=t.bodyB.parent;if(!(i.isSleeping&&r.isSleeping||i.isStatic||r.isStatic)&&(i.isSleeping||r.isSleeping)){var c=i.isSleeping&&!i.isStatic?i:r,g=c===i?r:i;!c.isStatic&&g.motion>l&&e.set(c,!1)}}}},e.set=function(h,l){var f=h.isSleeping;l?(h.isSleeping=!0,h.sleepCounter=h.sleepThreshold,h.positionImpulse.x=0,h.positionImpulse.y=0,h.positionPrev.x=h.position.x,h.positionPrev.y=h.position.y,h.anglePrev=h.angle,h.speed=0,h.angularSpeed=0,h.motion=0,f||n.trigger(h,"sleepStart")):(h.isSleeping=!1,h.sleepCounter=0,f&&n.trigger(h,"sleepEnd"))}})()},function(w,I,u){var e={};w.exports=e;var a=u(3),n=u(9);(function(){var s=[],h={overlap:0,axis:null},l={overlap:0,axis:null};e.create=function(f,o){return{pair:null,collided:!1,bodyA:f,bodyB:o,parentA:f.parent,parentB:o.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},e.collides=function(f,o,t){if(e._overlapAxes(h,f.vertices,o.vertices,f.axes),h.overlap<=0||(e._overlapAxes(l,o.vertices,f.vertices,o.axes),l.overlap<=0))return null;var i=t&&t.table[n.id(f,o)],r;i?r=i.collision:(r=e.create(f,o),r.collided=!0,r.bodyA=f.id<o.id?f:o,r.bodyB=f.id<o.id?o:f,r.parentA=r.bodyA.parent,r.parentB=r.bodyB.parent),f=r.bodyA,o=r.bodyB;var c;h.overlap<l.overlap?c=h:c=l;var g=r.normal,y=r.supports,C=c.axis,M=C.x,v=C.y;M*(o.position.x-f.position.x)+v*(o.position.y-f.position.y)<0?(g.x=M,g.y=v):(g.x=-M,g.y=-v),r.tangent.x=-g.y,r.tangent.y=g.x,r.depth=c.overlap,r.penetration.x=g.x*r.depth,r.penetration.y=g.y*r.depth;var p=e._findSupports(f,o,g,1),m=0;if(a.contains(f.vertices,p[0])&&(y[m++]=p[0]),a.contains(f.vertices,p[1])&&(y[m++]=p[1]),m<2){var d=e._findSupports(o,f,g,-1);a.contains(o.vertices,d[0])&&(y[m++]=d[0]),m<2&&a.contains(o.vertices,d[1])&&(y[m++]=d[1])}return m===0&&(y[m++]=p[0]),y.length=m,r},e._overlapAxes=function(f,o,t,i){var r=o.length,c=t.length,g=o[0].x,y=o[0].y,C=t[0].x,M=t[0].y,v=i.length,p=Number.MAX_VALUE,m=0,d,S,x,T,P,A;for(P=0;P<v;P++){var O=i[P],L=O.x,B=O.y,R=g*L+y*B,V=C*L+M*B,F=R,G=V;for(A=1;A<r;A+=1)T=o[A].x*L+o[A].y*B,T>F?F=T:T<R&&(R=T);for(A=1;A<c;A+=1)T=t[A].x*L+t[A].y*B,T>G?G=T:T<V&&(V=T);if(S=F-V,x=G-R,d=S<x?S:x,d<p&&(p=d,m=P,d<=0))break}f.axis=i[m],f.overlap=p},e._projectToAxis=function(f,o,t){for(var i=o[0].x*t.x+o[0].y*t.y,r=i,c=1;c<o.length;c+=1){var g=o[c].x*t.x+o[c].y*t.y;g>r?r=g:g<i&&(i=g)}f.min=i,f.max=r},e._findSupports=function(f,o,t,i){var r=o.vertices,c=r.length,g=f.position.x,y=f.position.y,C=t.x*i,M=t.y*i,v=Number.MAX_VALUE,p,m,d,S,x;for(x=0;x<c;x+=1)m=r[x],S=C*(g-m.x)+M*(y-m.y),S<v&&(v=S,p=m);return d=r[(c+p.index-1)%c],v=C*(g-d.x)+M*(y-d.y),m=r[(p.index+1)%c],C*(g-m.x)+M*(y-m.y)<v?(s[0]=p,s[1]=m,s):(s[0]=p,s[1]=d,s)}})()},function(w,I,u){var e={};w.exports=e;var a=u(16);(function(){e.create=function(n,s){var h=n.bodyA,l=n.bodyB,f={id:e.id(h,l),bodyA:h,bodyB:l,collision:n,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:h.isSensor||l.isSensor,timeCreated:s,timeUpdated:s,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return e.update(f,n,s),f},e.update=function(n,s,h){var l=n.contacts,f=s.supports,o=n.activeContacts,t=s.parentA,i=s.parentB,r=t.vertices.length;n.isActive=!0,n.timeUpdated=h,n.collision=s,n.separation=s.depth,n.inverseMass=t.inverseMass+i.inverseMass,n.friction=t.friction<i.friction?t.friction:i.friction,n.frictionStatic=t.frictionStatic>i.frictionStatic?t.frictionStatic:i.frictionStatic,n.restitution=t.restitution>i.restitution?t.restitution:i.restitution,n.slop=t.slop>i.slop?t.slop:i.slop,s.pair=n,o.length=0;for(var c=0;c<f.length;c++){var g=f[c],y=g.body===t?g.index:r+g.index,C=l[y];C?o.push(C):o.push(l[y]=a.create(g))}},e.setActive=function(n,s,h){s?(n.isActive=!0,n.timeUpdated=h):(n.isActive=!1,n.activeContacts.length=0)},e.id=function(n,s){return n.id<s.id?"A"+n.id+"B"+s.id:"A"+s.id+"B"+n.id}})()},function(w,I,u){var e={};w.exports=e;var a=u(3),n=u(2),s=u(7),h=u(1),l=u(11),f=u(0);(function(){e._warming=.4,e._torqueDampen=1,e._minLength=1e-6,e.create=function(o){var t=o;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var i=t.bodyA?n.add(t.bodyA.position,t.pointA):t.pointA,r=t.bodyB?n.add(t.bodyB.position,t.pointB):t.pointB,c=n.magnitude(n.sub(i,r));t.length=typeof t.length<"u"?t.length:c,t.id=t.id||f.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var g={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return t.length===0&&t.stiffness>.1?(g.type="pin",g.anchors=!1):t.stiffness<.9&&(g.type="spring"),t.render=f.extend(g,t.render),t},e.preSolveAll=function(o){for(var t=0;t<o.length;t+=1){var i=o[t],r=i.constraintImpulse;i.isStatic||r.x===0&&r.y===0&&r.angle===0||(i.position.x+=r.x,i.position.y+=r.y,i.angle+=r.angle)}},e.solveAll=function(o,t){for(var i=f.clamp(t/f._baseDelta,0,1),r=0;r<o.length;r+=1){var c=o[r],g=!c.bodyA||c.bodyA&&c.bodyA.isStatic,y=!c.bodyB||c.bodyB&&c.bodyB.isStatic;(g||y)&&e.solve(o[r],i)}for(r=0;r<o.length;r+=1)c=o[r],g=!c.bodyA||c.bodyA&&c.bodyA.isStatic,y=!c.bodyB||c.bodyB&&c.bodyB.isStatic,!g&&!y&&e.solve(o[r],i)},e.solve=function(o,t){var i=o.bodyA,r=o.bodyB,c=o.pointA,g=o.pointB;if(!(!i&&!r)){i&&!i.isStatic&&(n.rotate(c,i.angle-o.angleA,c),o.angleA=i.angle),r&&!r.isStatic&&(n.rotate(g,r.angle-o.angleB,g),o.angleB=r.angle);var y=c,C=g;if(i&&(y=n.add(i.position,c)),r&&(C=n.add(r.position,g)),!(!y||!C)){var M=n.sub(y,C),v=n.magnitude(M);v<e._minLength&&(v=e._minLength);var p=(v-o.length)/v,m=o.stiffness>=1||o.length===0,d=m?o.stiffness*t:o.stiffness*t*t,S=o.damping*t,x=n.mult(M,p*d),T=(i?i.inverseMass:0)+(r?r.inverseMass:0),P=(i?i.inverseInertia:0)+(r?r.inverseInertia:0),A=T+P,O,L,B,R,V;if(S>0){var F=n.create();B=n.div(M,v),V=n.sub(r&&n.sub(r.position,r.positionPrev)||F,i&&n.sub(i.position,i.positionPrev)||F),R=n.dot(B,V)}i&&!i.isStatic&&(L=i.inverseMass/T,i.constraintImpulse.x-=x.x*L,i.constraintImpulse.y-=x.y*L,i.position.x-=x.x*L,i.position.y-=x.y*L,S>0&&(i.positionPrev.x-=S*B.x*R*L,i.positionPrev.y-=S*B.y*R*L),O=n.cross(c,x)/A*e._torqueDampen*i.inverseInertia*(1-o.angularStiffness),i.constraintImpulse.angle-=O,i.angle-=O),r&&!r.isStatic&&(L=r.inverseMass/T,r.constraintImpulse.x+=x.x*L,r.constraintImpulse.y+=x.y*L,r.position.x+=x.x*L,r.position.y+=x.y*L,S>0&&(r.positionPrev.x+=S*B.x*R*L,r.positionPrev.y+=S*B.y*R*L),O=n.cross(g,x)/A*e._torqueDampen*r.inverseInertia*(1-o.angularStiffness),r.constraintImpulse.angle+=O,r.angle+=O)}}},e.postSolveAll=function(o){for(var t=0;t<o.length;t++){var i=o[t],r=i.constraintImpulse;if(!(i.isStatic||r.x===0&&r.y===0&&r.angle===0)){s.set(i,!1);for(var c=0;c<i.parts.length;c++){var g=i.parts[c];a.translate(g.vertices,r),c>0&&(g.position.x+=r.x,g.position.y+=r.y),r.angle!==0&&(a.rotate(g.vertices,r.angle,i.position),l.rotate(g.axes,r.angle),c>0&&n.rotateAbout(g.position,r.angle,i.position,g.position)),h.update(g.bounds,g.vertices,i.velocity)}r.angle*=e._warming,r.x*=e._warming,r.y*=e._warming}}},e.pointAWorld=function(o){return{x:(o.bodyA?o.bodyA.position.x:0)+(o.pointA?o.pointA.x:0),y:(o.bodyA?o.bodyA.position.y:0)+(o.pointA?o.pointA.y:0)}},e.pointBWorld=function(o){return{x:(o.bodyB?o.bodyB.position.x:0)+(o.pointB?o.pointB.x:0),y:(o.bodyB?o.bodyB.position.y:0)+(o.pointB?o.pointB.y:0)}}})()},function(w,I,u){var e={};w.exports=e;var a=u(2),n=u(0);(function(){e.fromVertices=function(s){for(var h={},l=0;l<s.length;l++){var f=(l+1)%s.length,o=a.normalise({x:s[f].y-s[l].y,y:s[l].x-s[f].x}),t=o.y===0?1/0:o.x/o.y;t=t.toFixed(3).toString(),h[t]=o}return n.values(h)},e.rotate=function(s,h){if(h!==0)for(var l=Math.cos(h),f=Math.sin(h),o=0;o<s.length;o++){var t=s[o],i;i=t.x*l-t.y*f,t.y=t.x*f+t.y*l,t.x=i}}})()},function(w,I,u){var e={};w.exports=e;var a=u(3),n=u(0),s=u(4),h=u(1),l=u(2);(function(){e.rectangle=function(f,o,t,i,r){r=r||{};var c={label:"Rectangle Body",position:{x:f,y:o},vertices:a.fromPath("L 0 0 L "+t+" 0 L "+t+" "+i+" L 0 "+i)};if(r.chamfer){var g=r.chamfer;c.vertices=a.chamfer(c.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete r.chamfer}return s.create(n.extend({},c,r))},e.trapezoid=function(f,o,t,i,r,c){c=c||{},r*=.5;var g=(1-r*2)*t,y=t*r,C=y+g,M=C+y,v;r<.5?v="L 0 0 L "+y+" "+-i+" L "+C+" "+-i+" L "+M+" 0":v="L 0 0 L "+C+" "+-i+" L "+M+" 0";var p={label:"Trapezoid Body",position:{x:f,y:o},vertices:a.fromPath(v)};if(c.chamfer){var m=c.chamfer;p.vertices=a.chamfer(p.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete c.chamfer}return s.create(n.extend({},p,c))},e.circle=function(f,o,t,i,r){i=i||{};var c={label:"Circle Body",circleRadius:t};r=r||25;var g=Math.ceil(Math.max(10,Math.min(r,t)));return g%2===1&&(g+=1),e.polygon(f,o,g,t,n.extend({},c,i))},e.polygon=function(f,o,t,i,r){if(r=r||{},t<3)return e.circle(f,o,i,r);for(var c=2*Math.PI/t,g="",y=c*.5,C=0;C<t;C+=1){var M=y+C*c,v=Math.cos(M)*i,p=Math.sin(M)*i;g+="L "+v.toFixed(3)+" "+p.toFixed(3)+" "}var m={label:"Polygon Body",position:{x:f,y:o},vertices:a.fromPath(g)};if(r.chamfer){var d=r.chamfer;m.vertices=a.chamfer(m.vertices,d.radius,d.quality,d.qualityMin,d.qualityMax),delete r.chamfer}return s.create(n.extend({},m,r))},e.fromVertices=function(f,o,t,i,r,c,g,y){var C=n.getDecomp(),M,v,p,m,d,S,x,T,P,A,O;for(M=!!(C&&C.quickDecomp),i=i||{},p=[],r=typeof r<"u"?r:!1,c=typeof c<"u"?c:.01,g=typeof g<"u"?g:10,y=typeof y<"u"?y:.01,n.isArray(t[0])||(t=[t]),A=0;A<t.length;A+=1)if(S=t[A],m=a.isConvex(S),d=!m,d&&!M&&n.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),m||!M)m?S=a.clockwiseSort(S):S=a.hull(S),p.push({position:{x:f,y:o},vertices:S});else{var L=S.map(function(U){return[U.x,U.y]});C.makeCCW(L),c!==!1&&C.removeCollinearPoints(L,c),y!==!1&&C.removeDuplicatePoints&&C.removeDuplicatePoints(L,y);var B=C.quickDecomp(L);for(x=0;x<B.length;x++){var R=B[x],V=R.map(function(U){return{x:U[0],y:U[1]}});g>0&&a.area(V)<g||p.push({position:a.centre(V),vertices:V})}}for(x=0;x<p.length;x++)p[x]=s.create(n.extend(p[x],i));if(r){var F=5;for(x=0;x<p.length;x++){var G=p[x];for(T=x+1;T<p.length;T++){var X=p[T];if(h.overlaps(G.bounds,X.bounds)){var W=G.vertices,z=X.vertices;for(P=0;P<G.vertices.length;P++)for(O=0;O<X.vertices.length;O++){var N=l.magnitudeSquared(l.sub(W[(P+1)%W.length],z[O])),Q=l.magnitudeSquared(l.sub(W[P],z[(O+1)%z.length]));N<F&&Q<F&&(W[P].isInternal=!0,z[O].isInternal=!0)}}}}}return p.length>1?(v=s.create(n.extend({parts:p.slice(0)},i)),s.setPosition(v,{x:f,y:o}),v):p[0]}})()},function(w,I,u){var e={};w.exports=e;var a=u(0),n=u(8);(function(){e.create=function(s){var h={bodies:[],pairs:null};return a.extend(h,s)},e.setBodies=function(s,h){s.bodies=h.slice(0)},e.clear=function(s){s.bodies=[]},e.collisions=function(s){var h=[],l=s.pairs,f=s.bodies,o=f.length,t=e.canCollide,i=n.collides,r,c;for(f.sort(e._compareBoundsX),r=0;r<o;r++){var g=f[r],y=g.bounds,C=g.bounds.max.x,M=g.bounds.max.y,v=g.bounds.min.y,p=g.isStatic||g.isSleeping,m=g.parts.length,d=m===1;for(c=r+1;c<o;c++){var S=f[c],x=S.bounds;if(x.min.x>C)break;if(!(M<x.min.y||v>x.max.y)&&!(p&&(S.isStatic||S.isSleeping))&&t(g.collisionFilter,S.collisionFilter)){var T=S.parts.length;if(d&&T===1){var P=i(g,S,l);P&&h.push(P)}else for(var A=m>1?1:0,O=T>1?1:0,L=A;L<m;L++)for(var B=g.parts[L],y=B.bounds,R=O;R<T;R++){var V=S.parts[R],x=V.bounds;if(!(y.min.x>x.max.x||y.max.x<x.min.x||y.max.y<x.min.y||y.min.y>x.max.y)){var P=i(B,V,l);P&&h.push(P)}}}}}return h},e.canCollide=function(s,h){return s.group===h.group&&s.group!==0?s.group>0:(s.mask&h.category)!==0&&(h.mask&s.category)!==0},e._compareBoundsX=function(s,h){return s.bounds.min.x-h.bounds.min.x}})()},function(w,I,u){var e={};w.exports=e;var a=u(0);(function(){e.create=function(n){var s={};return n||a.log("Mouse.create: element was undefined, defaulting to document.body","warn"),s.element=n||document.body,s.absolute={x:0,y:0},s.position={x:0,y:0},s.mousedownPosition={x:0,y:0},s.mouseupPosition={x:0,y:0},s.offset={x:0,y:0},s.scale={x:1,y:1},s.wheelDelta=0,s.button=-1,s.pixelRatio=parseInt(s.element.getAttribute("data-pixel-ratio"),10)||1,s.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},s.mousemove=function(h){var l=e._getRelativeMousePosition(h,s.element,s.pixelRatio),f=h.changedTouches;f&&(s.button=0,h.preventDefault()),s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.sourceEvents.mousemove=h},s.mousedown=function(h){var l=e._getRelativeMousePosition(h,s.element,s.pixelRatio),f=h.changedTouches;f?(s.button=0,h.preventDefault()):s.button=h.button,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mousedownPosition.x=s.position.x,s.mousedownPosition.y=s.position.y,s.sourceEvents.mousedown=h},s.mouseup=function(h){var l=e._getRelativeMousePosition(h,s.element,s.pixelRatio),f=h.changedTouches;f&&h.preventDefault(),s.button=-1,s.absolute.x=l.x,s.absolute.y=l.y,s.position.x=s.absolute.x*s.scale.x+s.offset.x,s.position.y=s.absolute.y*s.scale.y+s.offset.y,s.mouseupPosition.x=s.position.x,s.mouseupPosition.y=s.position.y,s.sourceEvents.mouseup=h},s.mousewheel=function(h){s.wheelDelta=Math.max(-1,Math.min(1,h.wheelDelta||-h.detail)),h.preventDefault()},e.setElement(s,s.element),s},e.setElement=function(n,s){n.element=s,s.addEventListener("mousemove",n.mousemove),s.addEventListener("mousedown",n.mousedown),s.addEventListener("mouseup",n.mouseup),s.addEventListener("mousewheel",n.mousewheel),s.addEventListener("DOMMouseScroll",n.mousewheel),s.addEventListener("touchmove",n.mousemove),s.addEventListener("touchstart",n.mousedown),s.addEventListener("touchend",n.mouseup)},e.clearSourceEvents=function(n){n.sourceEvents.mousemove=null,n.sourceEvents.mousedown=null,n.sourceEvents.mouseup=null,n.sourceEvents.mousewheel=null,n.wheelDelta=0},e.setOffset=function(n,s){n.offset.x=s.x,n.offset.y=s.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y},e.setScale=function(n,s){n.scale.x=s.x,n.scale.y=s.y,n.position.x=n.absolute.x*n.scale.x+n.offset.x,n.position.y=n.absolute.y*n.scale.y+n.offset.y},e._getRelativeMousePosition=function(n,s,h){var l=s.getBoundingClientRect(),f=document.documentElement||document.body.parentNode||document.body,o=window.pageXOffset!==void 0?window.pageXOffset:f.scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:f.scrollTop,i=n.changedTouches,r,c;return i?(r=i[0].pageX-l.left-o,c=i[0].pageY-l.top-t):(r=n.pageX-l.left-o,c=n.pageY-l.top-t),{x:r/(s.clientWidth/(s.width||s.clientWidth)*h),y:c/(s.clientHeight/(s.height||s.clientHeight)*h)}}})()},function(w,I,u){var e={};w.exports=e;var a=u(0);(function(){e._registry={},e.register=function(n){if(e.isPlugin(n)||a.warn("Plugin.register:",e.toString(n),"does not implement all required fields."),n.name in e._registry){var s=e._registry[n.name],h=e.versionParse(n.version).number,l=e.versionParse(s.version).number;h>l?(a.warn("Plugin.register:",e.toString(s),"was upgraded to",e.toString(n)),e._registry[n.name]=n):h<l?a.warn("Plugin.register:",e.toString(s),"can not be downgraded to",e.toString(n)):n!==s&&a.warn("Plugin.register:",e.toString(n),"is already registered to different plugin object")}else e._registry[n.name]=n;return n},e.resolve=function(n){return e._registry[e.dependencyParse(n).name]},e.toString=function(n){return typeof n=="string"?n:(n.name||"anonymous")+"@"+(n.version||n.range||"0.0.0")},e.isPlugin=function(n){return n&&n.name&&n.version&&n.install},e.isUsed=function(n,s){return n.used.indexOf(s)>-1},e.isFor=function(n,s){var h=n.for&&e.dependencyParse(n.for);return!n.for||s.name===h.name&&e.versionSatisfies(s.version,h.range)},e.use=function(n,s){if(n.uses=(n.uses||[]).concat(s||[]),n.uses.length===0){a.warn("Plugin.use:",e.toString(n),"does not specify any dependencies to install.");return}for(var h=e.dependencies(n),l=a.topologicalSort(h),f=[],o=0;o<l.length;o+=1)if(l[o]!==n.name){var t=e.resolve(l[o]);if(!t){f.push("❌ "+l[o]);continue}e.isUsed(n,t.name)||(e.isFor(t,n)||(a.warn("Plugin.use:",e.toString(t),"is for",t.for,"but installed on",e.toString(n)+"."),t._warned=!0),t.install?t.install(n):(a.warn("Plugin.use:",e.toString(t),"does not specify an install function."),t._warned=!0),t._warned?(f.push("🔶 "+e.toString(t)),delete t._warned):f.push("✅ "+e.toString(t)),n.used.push(t.name))}f.length>0&&a.info(f.join("  "))},e.dependencies=function(n,s){var h=e.dependencyParse(n),l=h.name;if(s=s||{},!(l in s)){n=e.resolve(n)||n,s[l]=a.map(n.uses||[],function(o){e.isPlugin(o)&&e.register(o);var t=e.dependencyParse(o),i=e.resolve(o);return i&&!e.versionSatisfies(i.version,t.range)?(a.warn("Plugin.dependencies:",e.toString(i),"does not satisfy",e.toString(t),"used by",e.toString(h)+"."),i._warned=!0,n._warned=!0):i||(a.warn("Plugin.dependencies:",e.toString(o),"used by",e.toString(h),"could not be resolved."),n._warned=!0),t.name});for(var f=0;f<s[l].length;f+=1)e.dependencies(s[l][f],s);return s}},e.dependencyParse=function(n){if(a.isString(n)){var s=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return s.test(n)||a.warn("Plugin.dependencyParse:",n,"is not a valid dependency string."),{name:n.split("@")[0],range:n.split("@")[1]||"*"}}return{name:n.name,range:n.range||n.version}},e.versionParse=function(n){var s=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;s.test(n)||a.warn("Plugin.versionParse:",n,"is not a valid version or range.");var h=s.exec(n),l=Number(h[4]),f=Number(h[5]),o=Number(h[6]);return{isRange:!!(h[1]||h[2]),version:h[3],range:n,operator:h[1]||h[2]||"",major:l,minor:f,patch:o,parts:[l,f,o],prerelease:h[7],number:l*1e8+f*1e4+o}},e.versionSatisfies=function(n,s){s=s||"*";var h=e.versionParse(s),l=e.versionParse(n);if(h.isRange){if(h.operator==="*"||n==="*")return!0;if(h.operator===">")return l.number>h.number;if(h.operator===">=")return l.number>=h.number;if(h.operator==="~")return l.major===h.major&&l.minor===h.minor&&l.patch>=h.patch;if(h.operator==="^")return h.major>0?l.major===h.major&&l.number>=h.number:h.minor>0?l.minor===h.minor&&l.patch>=h.patch:l.patch===h.patch}return n===s||n==="*"}})()},function(w,I){var u={};w.exports=u,function(){u.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}}()},function(w,I,u){var e={};w.exports=e;var a=u(7),n=u(18),s=u(13),h=u(19),l=u(5),f=u(6),o=u(10),t=u(0),i=u(4);(function(){e.create=function(r){r=r||{};var c={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},g=t.extend(c,r);return g.world=r.world||f.create({label:"World"}),g.pairs=r.pairs||h.create(),g.detector=r.detector||s.create(),g.grid={buckets:[]},g.world.gravity=g.gravity,g.broadphase=g.grid,g.metrics={},g},e.update=function(r,c){var g=t.now(),y=r.world,C=r.detector,M=r.pairs,v=r.timing,p=v.timestamp,m;c=typeof c<"u"?c:t._baseDelta,c*=v.timeScale,v.timestamp+=c,v.lastDelta=c;var d={timestamp:v.timestamp,delta:c};l.trigger(r,"beforeUpdate",d);var S=f.allBodies(y),x=f.allConstraints(y);for(y.isModified&&(s.setBodies(C,S),f.setModified(y,!1,!1,!0)),r.enableSleeping&&a.update(S,c),e._bodiesApplyGravity(S,r.gravity),c>0&&e._bodiesUpdate(S,c),o.preSolveAll(S),m=0;m<r.constraintIterations;m++)o.solveAll(x,c);o.postSolveAll(S),C.pairs=r.pairs;var T=s.collisions(C);h.update(M,T,p),r.enableSleeping&&a.afterCollisions(M.list),M.collisionStart.length>0&&l.trigger(r,"collisionStart",{pairs:M.collisionStart});var P=t.clamp(20/r.positionIterations,0,1);for(n.preSolvePosition(M.list),m=0;m<r.positionIterations;m++)n.solvePosition(M.list,c,P);for(n.postSolvePosition(S),o.preSolveAll(S),m=0;m<r.constraintIterations;m++)o.solveAll(x,c);for(o.postSolveAll(S),n.preSolveVelocity(M.list),m=0;m<r.velocityIterations;m++)n.solveVelocity(M.list,c);return e._bodiesUpdateVelocities(S),M.collisionActive.length>0&&l.trigger(r,"collisionActive",{pairs:M.collisionActive}),M.collisionEnd.length>0&&l.trigger(r,"collisionEnd",{pairs:M.collisionEnd}),e._bodiesClearForces(S),l.trigger(r,"afterUpdate",d),r.timing.lastElapsed=t.now()-g,r},e.merge=function(r,c){if(t.extend(r,c),c.world){r.world=c.world,e.clear(r);for(var g=f.allBodies(r.world),y=0;y<g.length;y++){var C=g[y];a.set(C,!1),C.id=t.nextId()}}},e.clear=function(r){h.clear(r.pairs),s.clear(r.detector)},e._bodiesClearForces=function(r){for(var c=r.length,g=0;g<c;g++){var y=r[g];y.force.x=0,y.force.y=0,y.torque=0}},e._bodiesApplyGravity=function(r,c){var g=typeof c.scale<"u"?c.scale:.001,y=r.length;if(!(c.x===0&&c.y===0||g===0))for(var C=0;C<y;C++){var M=r[C];M.isStatic||M.isSleeping||(M.force.y+=M.mass*c.y*g,M.force.x+=M.mass*c.x*g)}},e._bodiesUpdate=function(r,c){for(var g=r.length,y=0;y<g;y++){var C=r[y];C.isStatic||C.isSleeping||i.update(C,c)}},e._bodiesUpdateVelocities=function(r){for(var c=r.length,g=0;g<c;g++)i.updateVelocities(r[g])}})()},function(w,I,u){var e={};w.exports=e;var a=u(3),n=u(0),s=u(1);(function(){e._restingThresh=2,e._restingThreshTangent=Math.sqrt(6),e._positionDampen=.9,e._positionWarming=.8,e._frictionNormalMultiplier=5,e._frictionMaxStatic=Number.MAX_VALUE,e.preSolvePosition=function(h){var l,f,o,t=h.length;for(l=0;l<t;l++)f=h[l],f.isActive&&(o=f.activeContacts.length,f.collision.parentA.totalContacts+=o,f.collision.parentB.totalContacts+=o)},e.solvePosition=function(h,l,f){var o,t,i,r,c,g,y,C,M=e._positionDampen*(f||1),v=n.clamp(l/n._baseDelta,0,1),p=h.length;for(o=0;o<p;o++)t=h[o],!(!t.isActive||t.isSensor)&&(i=t.collision,r=i.parentA,c=i.parentB,g=i.normal,t.separation=g.x*(c.positionImpulse.x+i.penetration.x-r.positionImpulse.x)+g.y*(c.positionImpulse.y+i.penetration.y-r.positionImpulse.y));for(o=0;o<p;o++)t=h[o],!(!t.isActive||t.isSensor)&&(i=t.collision,r=i.parentA,c=i.parentB,g=i.normal,C=t.separation-t.slop*v,(r.isStatic||c.isStatic)&&(C*=2),r.isStatic||r.isSleeping||(y=M/r.totalContacts,r.positionImpulse.x+=g.x*C*y,r.positionImpulse.y+=g.y*C*y),c.isStatic||c.isSleeping||(y=M/c.totalContacts,c.positionImpulse.x-=g.x*C*y,c.positionImpulse.y-=g.y*C*y))},e.postSolvePosition=function(h){for(var l=e._positionWarming,f=h.length,o=a.translate,t=s.update,i=0;i<f;i++){var r=h[i],c=r.positionImpulse,g=c.x,y=c.y,C=r.velocity;if(r.totalContacts=0,g!==0||y!==0){for(var M=0;M<r.parts.length;M++){var v=r.parts[M];o(v.vertices,c),t(v.bounds,v.vertices,C),v.position.x+=g,v.position.y+=y}r.positionPrev.x+=g,r.positionPrev.y+=y,g*C.x+y*C.y<0?(c.x=0,c.y=0):(c.x*=l,c.y*=l)}}},e.preSolveVelocity=function(h){var l=h.length,f,o;for(f=0;f<l;f++){var t=h[f];if(!(!t.isActive||t.isSensor)){var i=t.activeContacts,r=i.length,c=t.collision,g=c.parentA,y=c.parentB,C=c.normal,M=c.tangent;for(o=0;o<r;o++){var v=i[o],p=v.vertex,m=v.normalImpulse,d=v.tangentImpulse;if(m!==0||d!==0){var S=C.x*m+M.x*d,x=C.y*m+M.y*d;g.isStatic||g.isSleeping||(g.positionPrev.x+=S*g.inverseMass,g.positionPrev.y+=x*g.inverseMass,g.anglePrev+=g.inverseInertia*((p.x-g.position.x)*x-(p.y-g.position.y)*S)),y.isStatic||y.isSleeping||(y.positionPrev.x-=S*y.inverseMass,y.positionPrev.y-=x*y.inverseMass,y.anglePrev-=y.inverseInertia*((p.x-y.position.x)*x-(p.y-y.position.y)*S))}}}}},e.solveVelocity=function(h,l){var f=l/n._baseDelta,o=f*f,t=o*f,i=-e._restingThresh*f,r=e._restingThreshTangent,c=e._frictionNormalMultiplier*f,g=e._frictionMaxStatic,y=h.length,C,M,v,p;for(v=0;v<y;v++){var m=h[v];if(!(!m.isActive||m.isSensor)){var d=m.collision,S=d.parentA,x=d.parentB,T=S.velocity,P=x.velocity,A=d.normal.x,O=d.normal.y,L=d.tangent.x,B=d.tangent.y,R=m.activeContacts,V=R.length,F=1/V,G=S.inverseMass+x.inverseMass,X=m.friction*m.frictionStatic*c;for(T.x=S.position.x-S.positionPrev.x,T.y=S.position.y-S.positionPrev.y,P.x=x.position.x-x.positionPrev.x,P.y=x.position.y-x.positionPrev.y,S.angularVelocity=S.angle-S.anglePrev,x.angularVelocity=x.angle-x.anglePrev,p=0;p<V;p++){var W=R[p],z=W.vertex,N=z.x-S.position.x,Q=z.y-S.position.y,U=z.x-x.position.x,J=z.y-x.position.y,K=T.x-Q*S.angularVelocity,Ce=T.y+N*S.angularVelocity,Me=P.x-J*x.angularVelocity,Pe=P.y+U*x.angularVelocity,ce=K-Me,ue=Ce-Pe,se=A*ce+O*ue,b=L*ce+B*ue,he=m.separation+se,re=Math.min(he,1);re=he<0?0:re;var ve=re*X;b<-ve||b>ve?(M=b>0?b:-b,C=m.friction*(b>0?1:-1)*t,C<-M?C=-M:C>M&&(C=M)):(C=b,M=g);var ge=N*O-Q*A,de=U*O-J*A,pe=F/(G+S.inverseInertia*ge*ge+x.inverseInertia*de*de),ee=(1+m.restitution)*se*pe;if(C*=pe,se<i)W.normalImpulse=0;else{var Ee=W.normalImpulse;W.normalImpulse+=ee,W.normalImpulse>0&&(W.normalImpulse=0),ee=W.normalImpulse-Ee}if(b<-r||b>r)W.tangentImpulse=0;else{var Te=W.tangentImpulse;W.tangentImpulse+=C,W.tangentImpulse<-M&&(W.tangentImpulse=-M),W.tangentImpulse>M&&(W.tangentImpulse=M),C=W.tangentImpulse-Te}var te=A*ee+L*C,ie=O*ee+B*C;S.isStatic||S.isSleeping||(S.positionPrev.x+=te*S.inverseMass,S.positionPrev.y+=ie*S.inverseMass,S.anglePrev+=(N*ie-Q*te)*S.inverseInertia),x.isStatic||x.isSleeping||(x.positionPrev.x-=te*x.inverseMass,x.positionPrev.y-=ie*x.inverseMass,x.anglePrev-=(U*ie-J*te)*x.inverseInertia)}}}}})()},function(w,I,u){var e={};w.exports=e;var a=u(9),n=u(0);(function(){e.create=function(s){return n.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},s)},e.update=function(s,h,l){var f=s.list,o=f.length,t=s.table,i=h.length,r=s.collisionStart,c=s.collisionEnd,g=s.collisionActive,y,C,M,v;for(r.length=0,c.length=0,g.length=0,v=0;v<o;v++)f[v].confirmedActive=!1;for(v=0;v<i;v++)y=h[v],M=y.pair,M?(M.isActive?g.push(M):r.push(M),a.update(M,y,l),M.confirmedActive=!0):(M=a.create(y,l),t[M.id]=M,r.push(M),f.push(M));var p=[];for(o=f.length,v=0;v<o;v++)M=f[v],M.confirmedActive||(a.setActive(M,!1,l),c.push(M),!M.collision.bodyA.isSleeping&&!M.collision.bodyB.isSleeping&&p.push(v));for(v=0;v<p.length;v++)C=p[v]-v,M=f[C],f.splice(C,1),delete t[M.id]},e.clear=function(s){return s.table={},s.list.length=0,s.collisionStart.length=0,s.collisionActive.length=0,s.collisionEnd.length=0,s}})()},function(w,I,u){var e=w.exports=u(21);e.Axes=u(11),e.Bodies=u(12),e.Body=u(4),e.Bounds=u(1),e.Collision=u(8),e.Common=u(0),e.Composite=u(6),e.Composites=u(22),e.Constraint=u(10),e.Contact=u(16),e.Detector=u(13),e.Engine=u(17),e.Events=u(5),e.Grid=u(23),e.Mouse=u(14),e.MouseConstraint=u(24),e.Pair=u(9),e.Pairs=u(19),e.Plugin=u(15),e.Query=u(25),e.Render=u(26),e.Resolver=u(18),e.Runner=u(27),e.SAT=u(28),e.Sleeping=u(7),e.Svg=u(29),e.Vector=u(2),e.Vertices=u(3),e.World=u(30),e.Engine.run=e.Runner.run,e.Common.deprecated(e.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(w,I,u){var e={};w.exports=e;var a=u(15),n=u(0);(function(){e.name="matter-js",e.version="0.19.0",e.uses=[],e.used=[],e.use=function(){a.use(e,Array.prototype.slice.call(arguments))},e.before=function(s,h){return s=s.replace(/^Matter./,""),n.chainPathBefore(e,s,h)},e.after=function(s,h){return s=s.replace(/^Matter./,""),n.chainPathAfter(e,s,h)}})()},function(w,I,u){var e={};w.exports=e;var a=u(6),n=u(10),s=u(0),h=u(4),l=u(12),f=s.deprecated;(function(){e.stack=function(o,t,i,r,c,g,y){for(var C=a.create({label:"Stack"}),M=o,v=t,p,m=0,d=0;d<r;d++){for(var S=0,x=0;x<i;x++){var T=y(M,v,x,d,p,m);if(T){var P=T.bounds.max.y-T.bounds.min.y,A=T.bounds.max.x-T.bounds.min.x;P>S&&(S=P),h.translate(T,{x:A*.5,y:P*.5}),M=T.bounds.max.x+c,a.addBody(C,T),p=T,m+=1}else M+=c}v+=S+g,M=o}return C},e.chain=function(o,t,i,r,c,g){for(var y=o.bodies,C=1;C<y.length;C++){var M=y[C-1],v=y[C],p=M.bounds.max.y-M.bounds.min.y,m=M.bounds.max.x-M.bounds.min.x,d=v.bounds.max.y-v.bounds.min.y,S=v.bounds.max.x-v.bounds.min.x,x={bodyA:M,pointA:{x:m*t,y:p*i},bodyB:v,pointB:{x:S*r,y:d*c}},T=s.extend(x,g);a.addConstraint(o,n.create(T))}return o.label+=" Chain",o},e.mesh=function(o,t,i,r,c){var g=o.bodies,y,C,M,v,p;for(y=0;y<i;y++){for(C=1;C<t;C++)M=g[C-1+y*t],v=g[C+y*t],a.addConstraint(o,n.create(s.extend({bodyA:M,bodyB:v},c)));if(y>0)for(C=0;C<t;C++)M=g[C+(y-1)*t],v=g[C+y*t],a.addConstraint(o,n.create(s.extend({bodyA:M,bodyB:v},c))),r&&C>0&&(p=g[C-1+(y-1)*t],a.addConstraint(o,n.create(s.extend({bodyA:p,bodyB:v},c)))),r&&C<t-1&&(p=g[C+1+(y-1)*t],a.addConstraint(o,n.create(s.extend({bodyA:p,bodyB:v},c))))}return o.label+=" Mesh",o},e.pyramid=function(o,t,i,r,c,g,y){return e.stack(o,t,i,r,c,g,function(C,M,v,p,m,d){var S=Math.min(r,Math.ceil(i/2)),x=m?m.bounds.max.x-m.bounds.min.x:0;if(!(p>S)){p=S-p;var T=p,P=i-1-p;if(!(v<T||v>P)){d===1&&h.translate(m,{x:(v+(i%2===1?1:-1))*x,y:0});var A=m?v*x:0;return y(o+A+v*c,M,v,p,m,d)}}})},e.newtonsCradle=function(o,t,i,r,c){for(var g=a.create({label:"Newtons Cradle"}),y=0;y<i;y++){var C=1.9,M=l.circle(o+y*(r*C),t+c,r,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),v=n.create({pointA:{x:o+y*(r*C),y:t},bodyB:M});a.addBody(g,M),a.addConstraint(g,v)}return g},f(e,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),e.car=function(o,t,i,r,c){var g=h.nextGroup(!0),y=20,C=-i*.5+y,M=i*.5-y,v=0,p=a.create({label:"Car"}),m=l.rectangle(o,t,i,r,{collisionFilter:{group:g},chamfer:{radius:r*.5},density:2e-4}),d=l.circle(o+C,t+v,c,{collisionFilter:{group:g},friction:.8}),S=l.circle(o+M,t+v,c,{collisionFilter:{group:g},friction:.8}),x=n.create({bodyB:m,pointB:{x:C,y:v},bodyA:d,stiffness:1,length:0}),T=n.create({bodyB:m,pointB:{x:M,y:v},bodyA:S,stiffness:1,length:0});return a.addBody(p,m),a.addBody(p,d),a.addBody(p,S),a.addConstraint(p,x),a.addConstraint(p,T),p},f(e,"car","Composites.car ➤ moved to car example"),e.softBody=function(o,t,i,r,c,g,y,C,M,v){M=s.extend({inertia:1/0},M),v=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},v);var p=e.stack(o,t,i,r,c,g,function(m,d){return l.circle(m,d,C,M)});return e.mesh(p,i,r,y,v),p.label="Soft Body",p},f(e,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")})()},function(w,I,u){var e={};w.exports=e;var a=u(9),n=u(0),s=n.deprecated;(function(){e.create=function(h){var l={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return n.extend(l,h)},e.update=function(h,l,f,o){var t,i,r,c=f.world,g=h.buckets,y,C,M=!1;for(t=0;t<l.length;t++){var v=l[t];if(!(v.isSleeping&&!o)&&!(c.bounds&&(v.bounds.max.x<c.bounds.min.x||v.bounds.min.x>c.bounds.max.x||v.bounds.max.y<c.bounds.min.y||v.bounds.min.y>c.bounds.max.y))){var p=e._getRegion(h,v);if(!v.region||p.id!==v.region.id||o){(!v.region||o)&&(v.region=p);var m=e._regionUnion(p,v.region);for(i=m.startCol;i<=m.endCol;i++)for(r=m.startRow;r<=m.endRow;r++){C=e._getBucketId(i,r),y=g[C];var d=i>=p.startCol&&i<=p.endCol&&r>=p.startRow&&r<=p.endRow,S=i>=v.region.startCol&&i<=v.region.endCol&&r>=v.region.startRow&&r<=v.region.endRow;!d&&S&&S&&y&&e._bucketRemoveBody(h,y,v),(v.region===p||d&&!S||o)&&(y||(y=e._createBucket(g,C)),e._bucketAddBody(h,y,v))}v.region=p,M=!0}}}M&&(h.pairsList=e._createActivePairsList(h))},s(e,"update","Grid.update ➤ replaced by Matter.Detector"),e.clear=function(h){h.buckets={},h.pairs={},h.pairsList=[]},s(e,"clear","Grid.clear ➤ replaced by Matter.Detector"),e._regionUnion=function(h,l){var f=Math.min(h.startCol,l.startCol),o=Math.max(h.endCol,l.endCol),t=Math.min(h.startRow,l.startRow),i=Math.max(h.endRow,l.endRow);return e._createRegion(f,o,t,i)},e._getRegion=function(h,l){var f=l.bounds,o=Math.floor(f.min.x/h.bucketWidth),t=Math.floor(f.max.x/h.bucketWidth),i=Math.floor(f.min.y/h.bucketHeight),r=Math.floor(f.max.y/h.bucketHeight);return e._createRegion(o,t,i,r)},e._createRegion=function(h,l,f,o){return{id:h+","+l+","+f+","+o,startCol:h,endCol:l,startRow:f,endRow:o}},e._getBucketId=function(h,l){return"C"+h+"R"+l},e._createBucket=function(h,l){var f=h[l]=[];return f},e._bucketAddBody=function(h,l,f){var o=h.pairs,t=a.id,i=l.length,r;for(r=0;r<i;r++){var c=l[r];if(!(f.id===c.id||f.isStatic&&c.isStatic)){var g=t(f,c),y=o[g];y?y[2]+=1:o[g]=[f,c,1]}}l.push(f)},e._bucketRemoveBody=function(h,l,f){var o=h.pairs,t=a.id,i;l.splice(n.indexOf(l,f),1);var r=l.length;for(i=0;i<r;i++){var c=o[t(f,l[i])];c&&(c[2]-=1)}},e._createActivePairsList=function(h){var l,f=h.pairs,o=n.keys(f),t=o.length,i=[],r;for(r=0;r<t;r++)l=f[o[r]],l[2]>0?i.push(l):delete f[o[r]];return i}})()},function(w,I,u){var e={};w.exports=e;var a=u(3),n=u(7),s=u(14),h=u(5),l=u(13),f=u(10),o=u(6),t=u(0),i=u(1);(function(){e.create=function(r,c){var g=(r?r.mouse:null)||(c?c.mouse:null);g||(r&&r.render&&r.render.canvas?g=s.create(r.render.canvas):c&&c.element?g=s.create(c.element):(g=s.create(),t.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var y=f.create({label:"Mouse Constraint",pointA:g.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),C={type:"mouseConstraint",mouse:g,element:null,body:null,constraint:y,collisionFilter:{category:1,mask:4294967295,group:0}},M=t.extend(C,c);return h.on(r,"beforeUpdate",function(){var v=o.allBodies(r.world);e.update(M,v),e._triggerEvents(M)}),M},e.update=function(r,c){var g=r.mouse,y=r.constraint,C=r.body;if(g.button===0){if(y.bodyB)n.set(y.bodyB,!1),y.pointA=g.position;else for(var M=0;M<c.length;M++)if(C=c[M],i.contains(C.bounds,g.position)&&l.canCollide(C.collisionFilter,r.collisionFilter))for(var v=C.parts.length>1?1:0;v<C.parts.length;v++){var p=C.parts[v];if(a.contains(p.vertices,g.position)){y.pointA=g.position,y.bodyB=r.body=C,y.pointB={x:g.position.x-C.position.x,y:g.position.y-C.position.y},y.angleB=C.angle,n.set(C,!1),h.trigger(r,"startdrag",{mouse:g,body:C});break}}}else y.bodyB=r.body=null,y.pointB=null,C&&h.trigger(r,"enddrag",{mouse:g,body:C})},e._triggerEvents=function(r){var c=r.mouse,g=c.sourceEvents;g.mousemove&&h.trigger(r,"mousemove",{mouse:c}),g.mousedown&&h.trigger(r,"mousedown",{mouse:c}),g.mouseup&&h.trigger(r,"mouseup",{mouse:c}),s.clearSourceEvents(c)}})()},function(w,I,u){var e={};w.exports=e;var a=u(2),n=u(8),s=u(1),h=u(12),l=u(3);(function(){e.collides=function(f,o){for(var t=[],i=o.length,r=f.bounds,c=n.collides,g=s.overlaps,y=0;y<i;y++){var C=o[y],M=C.parts.length,v=M===1?0:1;if(g(C.bounds,r))for(var p=v;p<M;p++){var m=C.parts[p];if(g(m.bounds,r)){var d=c(m,f);if(d){t.push(d);break}}}}return t},e.ray=function(f,o,t,i){i=i||1e-100;for(var r=a.angle(o,t),c=a.magnitude(a.sub(o,t)),g=(t.x+o.x)*.5,y=(t.y+o.y)*.5,C=h.rectangle(g,y,c,i,{angle:r}),M=e.collides(C,f),v=0;v<M.length;v+=1){var p=M[v];p.body=p.bodyB=p.bodyA}return M},e.region=function(f,o,t){for(var i=[],r=0;r<f.length;r++){var c=f[r],g=s.overlaps(c.bounds,o);(g&&!t||!g&&t)&&i.push(c)}return i},e.point=function(f,o){for(var t=[],i=0;i<f.length;i++){var r=f[i];if(s.contains(r.bounds,o))for(var c=r.parts.length===1?0:1;c<r.parts.length;c++){var g=r.parts[c];if(s.contains(g.bounds,o)&&l.contains(g.vertices,o)){t.push(r);break}}}return t}})()},function(w,I,u){var e={};w.exports=e;var a=u(4),n=u(0),s=u(6),h=u(1),l=u(5),f=u(2),o=u(14);(function(){var t,i;typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(v){window.setTimeout(function(){v(n.now())},1e3/60)},i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e._goodFps=30,e._goodDelta=1e3/60,e.create=function(v){var p={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!v.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},m=n.extend(p,v);return m.canvas&&(m.canvas.width=m.options.width||m.canvas.width,m.canvas.height=m.options.height||m.canvas.height),m.mouse=v.mouse,m.engine=v.engine,m.canvas=m.canvas||g(m.options.width,m.options.height),m.context=m.canvas.getContext("2d"),m.textures={},m.bounds=m.bounds||{min:{x:0,y:0},max:{x:m.canvas.width,y:m.canvas.height}},m.controller=e,m.options.showBroadphase=!1,m.options.pixelRatio!==1&&e.setPixelRatio(m,m.options.pixelRatio),n.isElement(m.element)&&m.element.appendChild(m.canvas),m},e.run=function(v){(function p(m){v.frameRequestId=t(p),r(v,m),e.world(v,m),(v.options.showStats||v.options.showDebug)&&e.stats(v,v.context,m),(v.options.showPerformance||v.options.showDebug)&&e.performance(v,v.context,m)})()},e.stop=function(v){i(v.frameRequestId)},e.setPixelRatio=function(v,p){var m=v.options,d=v.canvas;p==="auto"&&(p=y(d)),m.pixelRatio=p,d.setAttribute("data-pixel-ratio",p),d.width=m.width*p,d.height=m.height*p,d.style.width=m.width+"px",d.style.height=m.height+"px"},e.lookAt=function(v,p,m,d){d=typeof d<"u"?d:!0,p=n.isArray(p)?p:[p],m=m||{x:0,y:0};for(var S={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},x=0;x<p.length;x+=1){var T=p[x],P=T.bounds?T.bounds.min:T.min||T.position||T,A=T.bounds?T.bounds.max:T.max||T.position||T;P&&A&&(P.x<S.min.x&&(S.min.x=P.x),A.x>S.max.x&&(S.max.x=A.x),P.y<S.min.y&&(S.min.y=P.y),A.y>S.max.y&&(S.max.y=A.y))}var O=S.max.x-S.min.x+2*m.x,L=S.max.y-S.min.y+2*m.y,B=v.canvas.height,R=v.canvas.width,V=R/B,F=O/L,G=1,X=1;F>V?X=F/V:G=V/F,v.options.hasBounds=!0,v.bounds.min.x=S.min.x,v.bounds.max.x=S.min.x+O*G,v.bounds.min.y=S.min.y,v.bounds.max.y=S.min.y+L*X,d&&(v.bounds.min.x+=O*.5-O*G*.5,v.bounds.max.x+=O*.5-O*G*.5,v.bounds.min.y+=L*.5-L*X*.5,v.bounds.max.y+=L*.5-L*X*.5),v.bounds.min.x-=m.x,v.bounds.max.x-=m.x,v.bounds.min.y-=m.y,v.bounds.max.y-=m.y,v.mouse&&(o.setScale(v.mouse,{x:(v.bounds.max.x-v.bounds.min.x)/v.canvas.width,y:(v.bounds.max.y-v.bounds.min.y)/v.canvas.height}),o.setOffset(v.mouse,v.bounds.min))},e.startViewTransform=function(v){var p=v.bounds.max.x-v.bounds.min.x,m=v.bounds.max.y-v.bounds.min.y,d=p/v.options.width,S=m/v.options.height;v.context.setTransform(v.options.pixelRatio/d,0,0,v.options.pixelRatio/S,0,0),v.context.translate(-v.bounds.min.x,-v.bounds.min.y)},e.endViewTransform=function(v){v.context.setTransform(v.options.pixelRatio,0,0,v.options.pixelRatio,0,0)},e.world=function(v,p){var m=n.now(),d=v.engine,S=d.world,x=v.canvas,T=v.context,P=v.options,A=v.timing,O=s.allBodies(S),L=s.allConstraints(S),B=P.wireframes?P.wireframeBackground:P.background,R=[],V=[],F,G={timestamp:d.timing.timestamp};if(l.trigger(v,"beforeRender",G),v.currentBackground!==B&&M(v,B),T.globalCompositeOperation="source-in",T.fillStyle="transparent",T.fillRect(0,0,x.width,x.height),T.globalCompositeOperation="source-over",P.hasBounds){for(F=0;F<O.length;F++){var X=O[F];h.overlaps(X.bounds,v.bounds)&&R.push(X)}for(F=0;F<L.length;F++){var W=L[F],z=W.bodyA,N=W.bodyB,Q=W.pointA,U=W.pointB;z&&(Q=f.add(z.position,W.pointA)),N&&(U=f.add(N.position,W.pointB)),!(!Q||!U)&&(h.contains(v.bounds,Q)||h.contains(v.bounds,U))&&V.push(W)}e.startViewTransform(v),v.mouse&&(o.setScale(v.mouse,{x:(v.bounds.max.x-v.bounds.min.x)/v.options.width,y:(v.bounds.max.y-v.bounds.min.y)/v.options.height}),o.setOffset(v.mouse,v.bounds.min))}else V=L,R=O,v.options.pixelRatio!==1&&v.context.setTransform(v.options.pixelRatio,0,0,v.options.pixelRatio,0,0);!P.wireframes||d.enableSleeping&&P.showSleeping?e.bodies(v,R,T):(P.showConvexHulls&&e.bodyConvexHulls(v,R,T),e.bodyWireframes(v,R,T)),P.showBounds&&e.bodyBounds(v,R,T),(P.showAxes||P.showAngleIndicator)&&e.bodyAxes(v,R,T),P.showPositions&&e.bodyPositions(v,R,T),P.showVelocity&&e.bodyVelocity(v,R,T),P.showIds&&e.bodyIds(v,R,T),P.showSeparations&&e.separations(v,d.pairs.list,T),P.showCollisions&&e.collisions(v,d.pairs.list,T),P.showVertexNumbers&&e.vertexNumbers(v,R,T),P.showMousePosition&&e.mousePosition(v,v.mouse,T),e.constraints(V,T),P.hasBounds&&e.endViewTransform(v),l.trigger(v,"afterRender",G),A.lastElapsed=n.now()-m},e.stats=function(v,p,m){for(var d=v.engine,S=d.world,x=s.allBodies(S),T=0,P=55,A=44,O=0,L=0,B=0;B<x.length;B+=1)T+=x[B].parts.length;var R={Part:T,Body:x.length,Cons:s.allConstraints(S).length,Comp:s.allComposites(S).length,Pair:d.pairs.list.length};p.fillStyle="#0e0f19",p.fillRect(O,L,P*5.5,A),p.font="12px Arial",p.textBaseline="top",p.textAlign="right";for(var V in R){var F=R[V];p.fillStyle="#aaa",p.fillText(V,O+P,L+8),p.fillStyle="#eee",p.fillText(F,O+P,L+26),O+=P}},e.performance=function(v,p){var m=v.engine,d=v.timing,S=d.deltaHistory,x=d.elapsedHistory,T=d.timestampElapsedHistory,P=d.engineDeltaHistory,A=d.engineElapsedHistory,O=m.timing.lastDelta,L=c(S),B=c(x),R=c(P),V=c(A),F=c(T),G=F/L||0,X=1e3/L||0,W=4,z=12,N=60,Q=34,U=10,J=69;p.fillStyle="#0e0f19",p.fillRect(0,50,z*4+N*5+22,Q),e.status(p,U,J,N,W,S.length,Math.round(X)+" fps",X/e._goodFps,function(K){return S[K]/L-1}),e.status(p,U+z+N,J,N,W,P.length,O.toFixed(2)+" dt",e._goodDelta/O,function(K){return P[K]/R-1}),e.status(p,U+(z+N)*2,J,N,W,A.length,V.toFixed(2)+" ut",1-V/e._goodFps,function(K){return A[K]/V-1}),e.status(p,U+(z+N)*3,J,N,W,x.length,B.toFixed(2)+" rt",1-B/e._goodFps,function(K){return x[K]/B-1}),e.status(p,U+(z+N)*4,J,N,W,T.length,G.toFixed(2)+" x",G*G*G,function(K){return(T[K]/S[K]/G||0)-1})},e.status=function(v,p,m,d,S,x,T,P,A){v.strokeStyle="#888",v.fillStyle="#444",v.lineWidth=1,v.fillRect(p,m+7,d,1),v.beginPath(),v.moveTo(p,m+7-S*n.clamp(.4*A(0),-2,2));for(var O=0;O<d;O+=1)v.lineTo(p+O,m+7-(O<x?S*n.clamp(.4*A(O),-2,2):0));v.stroke(),v.fillStyle="hsl("+n.clamp(25+95*P,0,120)+",100%,60%)",v.fillRect(p,m-7,4,4),v.font="12px Arial",v.textBaseline="middle",v.textAlign="right",v.fillStyle="#eee",v.fillText(T,p+d,m-5)},e.constraints=function(v,p){for(var m=p,d=0;d<v.length;d++){var S=v[d];if(!(!S.render.visible||!S.pointA||!S.pointB)){var x=S.bodyA,T=S.bodyB,P,A;if(x?P=f.add(x.position,S.pointA):P=S.pointA,S.render.type==="pin")m.beginPath(),m.arc(P.x,P.y,3,0,2*Math.PI),m.closePath();else{if(T?A=f.add(T.position,S.pointB):A=S.pointB,m.beginPath(),m.moveTo(P.x,P.y),S.render.type==="spring")for(var O=f.sub(A,P),L=f.perp(f.normalise(O)),B=Math.ceil(n.clamp(S.length/5,12,20)),R,V=1;V<B;V+=1)R=V%2===0?1:-1,m.lineTo(P.x+O.x*(V/B)+L.x*R*4,P.y+O.y*(V/B)+L.y*R*4);m.lineTo(A.x,A.y)}S.render.lineWidth&&(m.lineWidth=S.render.lineWidth,m.strokeStyle=S.render.strokeStyle,m.stroke()),S.render.anchors&&(m.fillStyle=S.render.strokeStyle,m.beginPath(),m.arc(P.x,P.y,3,0,2*Math.PI),m.arc(A.x,A.y,3,0,2*Math.PI),m.closePath(),m.fill())}}},e.bodies=function(v,p,m){var d=m;v.engine;var S=v.options,x=S.showInternalEdges||!S.wireframes,T,P,A,O;for(A=0;A<p.length;A++)if(T=p[A],!!T.render.visible){for(O=T.parts.length>1?1:0;O<T.parts.length;O++)if(P=T.parts[O],!!P.render.visible){if(S.showSleeping&&T.isSleeping?d.globalAlpha=.5*P.render.opacity:P.render.opacity!==1&&(d.globalAlpha=P.render.opacity),P.render.sprite&&P.render.sprite.texture&&!S.wireframes){var L=P.render.sprite,B=C(v,L.texture);d.translate(P.position.x,P.position.y),d.rotate(P.angle),d.drawImage(B,B.width*-L.xOffset*L.xScale,B.height*-L.yOffset*L.yScale,B.width*L.xScale,B.height*L.yScale),d.rotate(-P.angle),d.translate(-P.position.x,-P.position.y)}else{if(P.circleRadius)d.beginPath(),d.arc(P.position.x,P.position.y,P.circleRadius,0,2*Math.PI);else{d.beginPath(),d.moveTo(P.vertices[0].x,P.vertices[0].y);for(var R=1;R<P.vertices.length;R++)!P.vertices[R-1].isInternal||x?d.lineTo(P.vertices[R].x,P.vertices[R].y):d.moveTo(P.vertices[R].x,P.vertices[R].y),P.vertices[R].isInternal&&!x&&d.moveTo(P.vertices[(R+1)%P.vertices.length].x,P.vertices[(R+1)%P.vertices.length].y);d.lineTo(P.vertices[0].x,P.vertices[0].y),d.closePath()}S.wireframes?(d.lineWidth=1,d.strokeStyle="#bbb",d.stroke()):(d.fillStyle=P.render.fillStyle,P.render.lineWidth&&(d.lineWidth=P.render.lineWidth,d.strokeStyle=P.render.strokeStyle,d.stroke()),d.fill())}d.globalAlpha=1}}},e.bodyWireframes=function(v,p,m){var d=m,S=v.options.showInternalEdges,x,T,P,A,O;for(d.beginPath(),P=0;P<p.length;P++)if(x=p[P],!!x.render.visible)for(O=x.parts.length>1?1:0;O<x.parts.length;O++){for(T=x.parts[O],d.moveTo(T.vertices[0].x,T.vertices[0].y),A=1;A<T.vertices.length;A++)!T.vertices[A-1].isInternal||S?d.lineTo(T.vertices[A].x,T.vertices[A].y):d.moveTo(T.vertices[A].x,T.vertices[A].y),T.vertices[A].isInternal&&!S&&d.moveTo(T.vertices[(A+1)%T.vertices.length].x,T.vertices[(A+1)%T.vertices.length].y);d.lineTo(T.vertices[0].x,T.vertices[0].y)}d.lineWidth=1,d.strokeStyle="#bbb",d.stroke()},e.bodyConvexHulls=function(v,p,m){var d=m,S,x,T;for(d.beginPath(),x=0;x<p.length;x++)if(S=p[x],!(!S.render.visible||S.parts.length===1)){for(d.moveTo(S.vertices[0].x,S.vertices[0].y),T=1;T<S.vertices.length;T++)d.lineTo(S.vertices[T].x,S.vertices[T].y);d.lineTo(S.vertices[0].x,S.vertices[0].y)}d.lineWidth=1,d.strokeStyle="rgba(255,255,255,0.2)",d.stroke()},e.vertexNumbers=function(v,p,m){var d=m,S,x,T;for(S=0;S<p.length;S++){var P=p[S].parts;for(T=P.length>1?1:0;T<P.length;T++){var A=P[T];for(x=0;x<A.vertices.length;x++)d.fillStyle="rgba(255,255,255,0.2)",d.fillText(S+"_"+x,A.position.x+(A.vertices[x].x-A.position.x)*.8,A.position.y+(A.vertices[x].y-A.position.y)*.8)}}},e.mousePosition=function(v,p,m){var d=m;d.fillStyle="rgba(255,255,255,0.8)",d.fillText(p.position.x+"  "+p.position.y,p.position.x+5,p.position.y-5)},e.bodyBounds=function(v,p,m){var d=m;v.engine;var S=v.options;d.beginPath();for(var x=0;x<p.length;x++){var T=p[x];if(T.render.visible)for(var P=p[x].parts,A=P.length>1?1:0;A<P.length;A++){var O=P[A];d.rect(O.bounds.min.x,O.bounds.min.y,O.bounds.max.x-O.bounds.min.x,O.bounds.max.y-O.bounds.min.y)}}S.wireframes?d.strokeStyle="rgba(255,255,255,0.08)":d.strokeStyle="rgba(0,0,0,0.1)",d.lineWidth=1,d.stroke()},e.bodyAxes=function(v,p,m){var d=m;v.engine;var S=v.options,x,T,P,A;for(d.beginPath(),T=0;T<p.length;T++){var O=p[T],L=O.parts;if(O.render.visible)if(S.showAxes)for(P=L.length>1?1:0;P<L.length;P++)for(x=L[P],A=0;A<x.axes.length;A++){var B=x.axes[A];d.moveTo(x.position.x,x.position.y),d.lineTo(x.position.x+B.x*20,x.position.y+B.y*20)}else for(P=L.length>1?1:0;P<L.length;P++)for(x=L[P],A=0;A<x.axes.length;A++)d.moveTo(x.position.x,x.position.y),d.lineTo((x.vertices[0].x+x.vertices[x.vertices.length-1].x)/2,(x.vertices[0].y+x.vertices[x.vertices.length-1].y)/2)}S.wireframes?(d.strokeStyle="indianred",d.lineWidth=1):(d.strokeStyle="rgba(255, 255, 255, 0.4)",d.globalCompositeOperation="overlay",d.lineWidth=2),d.stroke(),d.globalCompositeOperation="source-over"},e.bodyPositions=function(v,p,m){var d=m;v.engine;var S=v.options,x,T,P,A;for(d.beginPath(),P=0;P<p.length;P++)if(x=p[P],!!x.render.visible)for(A=0;A<x.parts.length;A++)T=x.parts[A],d.arc(T.position.x,T.position.y,3,0,2*Math.PI,!1),d.closePath();for(S.wireframes?d.fillStyle="indianred":d.fillStyle="rgba(0,0,0,0.5)",d.fill(),d.beginPath(),P=0;P<p.length;P++)x=p[P],x.render.visible&&(d.arc(x.positionPrev.x,x.positionPrev.y,2,0,2*Math.PI,!1),d.closePath());d.fillStyle="rgba(255,165,0,0.8)",d.fill()},e.bodyVelocity=function(v,p,m){var d=m;d.beginPath();for(var S=0;S<p.length;S++){var x=p[S];if(x.render.visible){var T=a.getVelocity(x);d.moveTo(x.position.x,x.position.y),d.lineTo(x.position.x+T.x,x.position.y+T.y)}}d.lineWidth=3,d.strokeStyle="cornflowerblue",d.stroke()},e.bodyIds=function(v,p,m){var d=m,S,x;for(S=0;S<p.length;S++)if(p[S].render.visible){var T=p[S].parts;for(x=T.length>1?1:0;x<T.length;x++){var P=T[x];d.font="12px Arial",d.fillStyle="rgba(255,255,255,0.5)",d.fillText(P.id,P.position.x+10,P.position.y-10)}}},e.collisions=function(v,p,m){var d=m,S=v.options,x,T,P,A;for(d.beginPath(),P=0;P<p.length;P++)if(x=p[P],!!x.isActive)for(T=x.collision,A=0;A<x.activeContacts.length;A++){var O=x.activeContacts[A],L=O.vertex;d.rect(L.x-1.5,L.y-1.5,3.5,3.5)}for(S.wireframes?d.fillStyle="rgba(255,255,255,0.7)":d.fillStyle="orange",d.fill(),d.beginPath(),P=0;P<p.length;P++)if(x=p[P],!!x.isActive&&(T=x.collision,x.activeContacts.length>0)){var B=x.activeContacts[0].vertex.x,R=x.activeContacts[0].vertex.y;x.activeContacts.length===2&&(B=(x.activeContacts[0].vertex.x+x.activeContacts[1].vertex.x)/2,R=(x.activeContacts[0].vertex.y+x.activeContacts[1].vertex.y)/2),T.bodyB===T.supports[0].body||T.bodyA.isStatic===!0?d.moveTo(B-T.normal.x*8,R-T.normal.y*8):d.moveTo(B+T.normal.x*8,R+T.normal.y*8),d.lineTo(B,R)}S.wireframes?d.strokeStyle="rgba(255,165,0,0.7)":d.strokeStyle="orange",d.lineWidth=1,d.stroke()},e.separations=function(v,p,m){var d=m,S=v.options,x,T,P,A,O;for(d.beginPath(),O=0;O<p.length;O++)if(x=p[O],!!x.isActive){T=x.collision,P=T.bodyA,A=T.bodyB;var L=1;!A.isStatic&&!P.isStatic&&(L=.5),A.isStatic&&(L=0),d.moveTo(A.position.x,A.position.y),d.lineTo(A.position.x-T.penetration.x*L,A.position.y-T.penetration.y*L),L=1,!A.isStatic&&!P.isStatic&&(L=.5),P.isStatic&&(L=0),d.moveTo(P.position.x,P.position.y),d.lineTo(P.position.x+T.penetration.x*L,P.position.y+T.penetration.y*L)}S.wireframes?d.strokeStyle="rgba(255,165,0,0.5)":d.strokeStyle="orange",d.stroke()},e.inspector=function(v,p){v.engine;var m=v.selected,d=v.render,S=d.options,x;if(S.hasBounds){var T=d.bounds.max.x-d.bounds.min.x,P=d.bounds.max.y-d.bounds.min.y,A=T/d.options.width,O=P/d.options.height;p.scale(1/A,1/O),p.translate(-d.bounds.min.x,-d.bounds.min.y)}for(var L=0;L<m.length;L++){var B=m[L].data;switch(p.translate(.5,.5),p.lineWidth=1,p.strokeStyle="rgba(255,165,0,0.9)",p.setLineDash([1,2]),B.type){case"body":x=B.bounds,p.beginPath(),p.rect(Math.floor(x.min.x-3),Math.floor(x.min.y-3),Math.floor(x.max.x-x.min.x+6),Math.floor(x.max.y-x.min.y+6)),p.closePath(),p.stroke();break;case"constraint":var R=B.pointA;B.bodyA&&(R=B.pointB),p.beginPath(),p.arc(R.x,R.y,10,0,2*Math.PI),p.closePath(),p.stroke();break}p.setLineDash([]),p.translate(-.5,-.5)}v.selectStart!==null&&(p.translate(.5,.5),p.lineWidth=1,p.strokeStyle="rgba(255,165,0,0.6)",p.fillStyle="rgba(255,165,0,0.1)",x=v.selectBounds,p.beginPath(),p.rect(Math.floor(x.min.x),Math.floor(x.min.y),Math.floor(x.max.x-x.min.x),Math.floor(x.max.y-x.min.y)),p.closePath(),p.stroke(),p.fill(),p.translate(-.5,-.5)),S.hasBounds&&p.setTransform(1,0,0,1,0,0)};var r=function(v,p){var m=v.engine,d=v.timing,S=d.historySize,x=m.timing.timestamp;d.delta=p-d.lastTime||e._goodDelta,d.lastTime=p,d.timestampElapsed=x-d.lastTimestamp||0,d.lastTimestamp=x,d.deltaHistory.unshift(d.delta),d.deltaHistory.length=Math.min(d.deltaHistory.length,S),d.engineDeltaHistory.unshift(m.timing.lastDelta),d.engineDeltaHistory.length=Math.min(d.engineDeltaHistory.length,S),d.timestampElapsedHistory.unshift(d.timestampElapsed),d.timestampElapsedHistory.length=Math.min(d.timestampElapsedHistory.length,S),d.engineElapsedHistory.unshift(m.timing.lastElapsed),d.engineElapsedHistory.length=Math.min(d.engineElapsedHistory.length,S),d.elapsedHistory.unshift(d.lastElapsed),d.elapsedHistory.length=Math.min(d.elapsedHistory.length,S)},c=function(v){for(var p=0,m=0;m<v.length;m+=1)p+=v[m];return p/v.length||0},g=function(v,p){var m=document.createElement("canvas");return m.width=v,m.height=p,m.oncontextmenu=function(){return!1},m.onselectstart=function(){return!1},m},y=function(v){var p=v.getContext("2d"),m=window.devicePixelRatio||1,d=p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1;return m/d},C=function(v,p){var m=v.textures[p];return m||(m=v.textures[p]=new Image,m.src=p,m)},M=function(v,p){var m=p;/(jpg|gif|png)$/.test(p)&&(m="url("+p+")"),v.canvas.style.background=m,v.canvas.style.backgroundSize="contain",v.currentBackground=p}})()},function(w,I,u){var e={};w.exports=e;var a=u(5),n=u(17),s=u(0);(function(){var h,l;if(typeof window<"u"&&(h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),!h){var f;h=function(o){f=setTimeout(function(){o(s.now())},1e3/60)},l=function(){clearTimeout(f)}}e.create=function(o){var t={fps:60,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,frameRequestId:null,isFixed:!1,enabled:!0},i=s.extend(t,o);return i.delta=i.delta||1e3/i.fps,i.deltaMin=i.deltaMin||1e3/i.fps,i.deltaMax=i.deltaMax||1e3/(i.fps*.5),i.fps=1e3/i.delta,i},e.run=function(o,t){return typeof o.positionIterations<"u"&&(t=o,o=e.create()),function i(r){o.frameRequestId=h(i),r&&o.enabled&&e.tick(o,t,r)}(),o},e.tick=function(o,t,i){var r=t.timing,c;o.isFixed?c=o.delta:(c=i-o.timePrev||o.delta,o.timePrev=i,o.deltaHistory.push(c),o.deltaHistory=o.deltaHistory.slice(-o.deltaSampleSize),c=Math.min.apply(null,o.deltaHistory),c=c<o.deltaMin?o.deltaMin:c,c=c>o.deltaMax?o.deltaMax:c,o.delta=c);var g={timestamp:r.timestamp};a.trigger(o,"beforeTick",g),o.frameCounter+=1,i-o.counterTimestamp>=1e3&&(o.fps=o.frameCounter*((i-o.counterTimestamp)/1e3),o.counterTimestamp=i,o.frameCounter=0),a.trigger(o,"tick",g),a.trigger(o,"beforeUpdate",g),n.update(t,c),a.trigger(o,"afterUpdate",g),a.trigger(o,"afterTick",g)},e.stop=function(o){l(o.frameRequestId)},e.start=function(o,t){e.run(o,t)}})()},function(w,I,u){var e={};w.exports=e;var a=u(8),n=u(0),s=n.deprecated;(function(){e.collides=function(h,l){return a.collides(h,l)},s(e,"collides","SAT.collides ➤ replaced by Collision.collides")})()},function(w,I,u){var e={};w.exports=e,u(1);var a=u(0);(function(){e.pathToVertices=function(n,s){typeof window<"u"&&!("SVGPathSeg"in window)&&a.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var h,l,f,o,t,i,r,c,g,y,C=[],M,v,p=0,m=0,d=0;s=s||15;var S=function(T,P,A){var O=A%2===1&&A>1;if(!g||T!=g.x||P!=g.y){g&&O?(M=g.x,v=g.y):(M=0,v=0);var L={x:M+T,y:v+P};(O||!g)&&(g=L),C.push(L),m=M+T,d=v+P}},x=function(T){var P=T.pathSegTypeAsLetter.toUpperCase();if(P!=="Z"){switch(P){case"M":case"L":case"T":case"C":case"S":case"Q":m=T.x,d=T.y;break;case"H":m=T.x;break;case"V":d=T.y;break}S(m,d,T.pathSegType)}};for(e._svgPathToAbsolute(n),f=n.getTotalLength(),i=[],h=0;h<n.pathSegList.numberOfItems;h+=1)i.push(n.pathSegList.getItem(h));for(r=i.concat();p<f;){if(y=n.getPathSegAtLength(p),t=i[y],t!=c){for(;r.length&&r[0]!=t;)x(r.shift());c=t}switch(t.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":o=n.getPointAtLength(p),S(o.x,o.y,0);break}p+=s}for(h=0,l=r.length;h<l;++h)x(r[h]);return C},e._svgPathToAbsolute=function(n){for(var s,h,l,f,o,t,i=n.pathSegList,r=0,c=0,g=i.numberOfItems,y=0;y<g;++y){var C=i.getItem(y),M=C.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(M))"x"in C&&(r=C.x),"y"in C&&(c=C.y);else switch("x1"in C&&(l=r+C.x1),"x2"in C&&(o=r+C.x2),"y1"in C&&(f=c+C.y1),"y2"in C&&(t=c+C.y2),"x"in C&&(r+=C.x),"y"in C&&(c+=C.y),M){case"m":i.replaceItem(n.createSVGPathSegMovetoAbs(r,c),y);break;case"l":i.replaceItem(n.createSVGPathSegLinetoAbs(r,c),y);break;case"h":i.replaceItem(n.createSVGPathSegLinetoHorizontalAbs(r),y);break;case"v":i.replaceItem(n.createSVGPathSegLinetoVerticalAbs(c),y);break;case"c":i.replaceItem(n.createSVGPathSegCurvetoCubicAbs(r,c,l,f,o,t),y);break;case"s":i.replaceItem(n.createSVGPathSegCurvetoCubicSmoothAbs(r,c,o,t),y);break;case"q":i.replaceItem(n.createSVGPathSegCurvetoQuadraticAbs(r,c,l,f),y);break;case"t":i.replaceItem(n.createSVGPathSegCurvetoQuadraticSmoothAbs(r,c),y);break;case"a":i.replaceItem(n.createSVGPathSegArcAbs(r,c,C.r1,C.r2,C.angle,C.largeArcFlag,C.sweepFlag),y);break;case"z":case"Z":r=s,c=h;break}(M=="M"||M=="m")&&(s=r,h=c)}}})()},function(w,I,u){var e={};w.exports=e;var a=u(6);u(0),function(){e.create=a.create,e.add=a.add,e.remove=a.remove,e.clear=a.clear,e.addComposite=a.addComposite,e.addBody=a.addBody,e.addConstraint=a.addConstraint}()}])})})(we);var Y=we.exports;const q=[{key:"tier0",radius:16,mass:1,img:"fruits/icon_01.png",label:"Lv1"},{key:"tier1",radius:22,mass:1.2,img:"fruits/icon_02.png",label:"Lv2"},{key:"tier2",radius:30,mass:1.4,img:"fruits/icon_03.png",label:"Lv3"},{key:"tier3",radius:40,mass:1.8,img:"fruits/icon_04.png",label:"Lv4"},{key:"tier4",radius:52,mass:2.2,img:"fruits/icon_05.png",label:"Lv5"},{key:"tier5",radius:64,mass:3,img:"fruits/icon_06.png",label:"Lv6"},{key:"tier6",radius:78,mass:3.6,img:"fruits/icon_07.png",label:"Lv7"},{key:"tier7",radius:92,mass:4.5,img:"fruits/icon_08.png",label:"Lv8"},{key:"tier8",radius:108,mass:5.2,img:"fruits/icon_09.png",label:"Lv9"},{key:"tier9",radius:124,mass:6,img:"fruits/icon_10.png",label:"Lv10"},{key:"tier10",radius:140,mass:7,img:"fruits/icon_11.png",label:"MAX"}],oe={gravityY:.8,friction:.3,restitution:.1},$={width:900,height:1600,wallThickness:40,spawnY:100,gameOverLineY:Math.round(1600*(3/16))},H={scale:1,cssScale:1,offsetX:0,offsetY:0,worldW:$.width,worldH:$.height},me={mergeBase:10,comboWindowMs:1200},Le=2;function Z(k){return q[k].radius*Le}function xe(k){return"/assets/"+k}class Oe{constructor(E){D(this,"ctx");D(this,"images",new Map);D(this,"previewCtx");D(this,"backgroundImage",null);this.canvas=E;const w=E.getContext("2d");if(!w)throw new Error("Could not get 2D context");this.ctx=w;const u=document.getElementById("preview").getContext("2d");if(!u)throw new Error("Could not get preview 2D context");this.previewCtx=u}async loadImages(){const E=new Promise((I,u)=>{const e=new Image;e.src=xe("background/bg_01.png"),e.onload=()=>{this.backgroundImage=e,I()},e.onerror=()=>u(new Error("Failed to load background image: background/bg_01.png"))}),w=q.map(async(I,u)=>{const e=new Image;e.src=xe(I.img),await new Promise((a,n)=>{e.onload=()=>a(),e.onerror=()=>n(new Error(`Failed to load image: ${I.img}`))}),this.images.set(u,e)});await Promise.all([E,...w])}resizeCanvas(){const E=Math.max(1,window.devicePixelRatio||1),I=document.querySelector(".game-wrap").getBoundingClientRect(),u=Math.max(1,I.width),e=Math.max(1,I.height),a=H.worldW/H.worldH;let n=u,s=Math.floor(u/a);s>e&&(s=e,n=Math.floor(e*a)),this.canvas.style.width=n+"px",this.canvas.style.height=s+"px",this.canvas.width=Math.round(n*E),this.canvas.height=Math.round(s*E),H.scale=Math.min(this.canvas.width/H.worldW,this.canvas.height/H.worldH),H.cssScale=(parseFloat(this.canvas.style.width)||n)/H.worldW,H.offsetX=(u-n)/2,H.offsetY=(e-s)/2}canvasPxToWorldX(E){return E/H.scale}canvasPxToWorldY(E){return E/H.scale}clientToWorldFromEvent(E){var n,s;const w=this.canvas.getBoundingClientRect(),I="touches"in E&&((n=E.touches)!=null&&n.length)?E.touches[0].clientX:E.clientX,u="touches"in E&&((s=E.touches)!=null&&s.length)?E.touches[0].clientY:E.clientY,e=I-w.left,a=u-w.top;return{x:e/H.cssScale,y:a/H.cssScale}}clear(){this.ctx.setTransform(1,0,0,1,0,0),this.backgroundImage?this.ctx.drawImage(this.backgroundImage,0,0,this.canvas.width,this.canvas.height):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawWorldBounds(){this.ctx.save(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=2,this.ctx.strokeRect(0,0,$.width*H.scale,$.height*H.scale),this.ctx.restore()}drawGameOverLine(){this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.lineWidth=2;const E=$.gameOverLineY*H.scale;this.ctx.beginPath(),this.ctx.moveTo(0,E),this.ctx.lineTo(this.canvas.width,E),this.ctx.stroke(),this.ctx.restore()}drawBodies(E){this.ctx.save();for(const w of E){const I=this.images.get(w.tierIndex),u=Z(w.tierIndex),e=w.x*H.scale,a=w.y*H.scale,n=u*H.scale;if(!I){this.ctx.fillStyle=this.getFruitColor(w.tierIndex),this.ctx.beginPath(),this.ctx.arc(e,a,n,0,Math.PI*2),this.ctx.fill();continue}this.ctx.save(),this.ctx.translate(e,a),this.ctx.rotate(w.angle);const s=n*2;this.ctx.drawImage(I,-n,-n,s,s),this.ctx.restore()}this.ctx.restore()}drawDropper(E,w){const I=this.images.get(w),u=Z(w),e=E*H.scale,a=$.spawnY*H.scale,n=u*H.scale;if(!I){this.ctx.save(),this.ctx.globalAlpha=.6,this.ctx.fillStyle=this.getFruitColor(w),this.ctx.beginPath(),this.ctx.arc(e,a,n,0,Math.PI*2),this.ctx.fill(),this.ctx.restore();return}this.ctx.save(),this.ctx.globalAlpha=.6;const s=n*2;this.ctx.drawImage(I,e-n,a-n,s,s),this.ctx.restore()}drawEffects(E){this.ctx.save();for(const w of E){const I=w.t/w.duration,u=1-I,e=1+I*.5,a=w.x*H.scale,n=w.y*H.scale;this.ctx.globalAlpha=u,this.ctx.fillStyle="#ffffff",this.ctx.beginPath(),this.ctx.arc(a,n,8*e*H.scale,0,Math.PI*2),this.ctx.fill()}this.ctx.restore()}updatePreview(E){const w=this.images.get(E);if(!w){this.previewCtx.fillStyle=this.getFruitColor(E),this.previewCtx.beginPath(),this.previewCtx.arc(32,32,24,0,Math.PI*2),this.previewCtx.fill();return}this.previewCtx.clearRect(0,0,64,64),this.previewCtx.drawImage(w,0,0,64,64)}getFruitColor(E){const w=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#ff6348"];return w[E%w.length]}}function ye(k,E,w){var s,h;const I=E.getBoundingClientRect(),u="touches"in k&&((s=k.touches)!=null&&s.length)?k.touches[0].clientX:k.clientX,e="touches"in k&&((h=k.touches)!=null&&h.length)?k.touches[0].clientY:k.clientY,a=u-I.left,n=e-I.top;return{x:a/w,y:n/w}}class Re{constructor(E,w,I){D(this,"left",!1);D(this,"right",!1);D(this,"drop",!1);D(this,"axisX",0);D(this,"unsubscribeFns",[]);this.canvas=E,this.mapToWorldX=w,this.renderer=I,this.init()}init(){const E=(t,i)=>{(t.code==="ArrowLeft"||t.code==="KeyA")&&(this.left=i),(t.code==="ArrowRight"||t.code==="KeyD")&&(this.right=i),(t.code==="Space"||t.code==="ArrowDown")&&i&&(this.drop=!0)},w=t=>E(t,!0),I=t=>E(t,!1);window.addEventListener("keydown",w,{passive:!0}),window.addEventListener("keyup",I,{passive:!0}),this.unsubscribeFns.push(()=>{window.removeEventListener("keydown",w),window.removeEventListener("keyup",I)});const u=t=>{const i=ye(t,this.canvas,H.cssScale);this.axisX=0,this._lastTouchWorldX=i.x},e=t=>{if(this._lastTouchWorldX==null)return;const i=ye(t,this.canvas,H.cssScale);this._lastTouchWorldX=i.x},a=()=>{this._lastTouchWorldX!=null&&(this.drop=!0),this._lastTouchWorldX=null},n=t=>{u(t)},s=t=>{e(t)},h=()=>{a()};this.canvas.addEventListener("mousedown",n),window.addEventListener("mousemove",s),window.addEventListener("mouseup",h),this.unsubscribeFns.push(()=>{this.canvas.removeEventListener("mousedown",n),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",h)});const l=t=>{t.changedTouches[0]&&u(t)},f=t=>{t.changedTouches[0]&&e(t)},o=()=>{a()};this.canvas.addEventListener("touchstart",l,{passive:!0}),this.canvas.addEventListener("touchmove",f,{passive:!0}),this.canvas.addEventListener("touchend",o,{passive:!0}),this.unsubscribeFns.push(()=>{this.canvas.removeEventListener("touchstart",l),this.canvas.removeEventListener("touchmove",f),this.canvas.removeEventListener("touchend",o)})}consumeDrop(){const E=this.drop;return this.drop=!1,E}getTouchWorldX(){return this._lastTouchWorldX??null}dispose(){this.unsubscribeFns.forEach(E=>E())}}class Be{constructor(){D(this,"ctx",null);D(this,"muted",!1);D(this,"unlocked",!1);try{this.muted=localStorage.getItem("sound-muted")==="1"}catch{}}get isMuted(){return this.muted}setMuted(E){this.muted=E;try{localStorage.setItem("sound-muted",E?"1":"0")}catch{}}ensureContext(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}unlock(){if(this.unlocked)return;this.ensureContext();const E=this.ctx,w=E.createBuffer(1,1,E.sampleRate),I=E.createBufferSource();I.buffer=w,I.connect(E.destination),I.start(0),this.unlocked=!0}play(E){if(!this.muted)switch(this.ensureContext(),E){case"pop":this.tone({freq:880,duration:.06,type:"square",gain:.06});break;case"land":this.tone({freq:180,duration:.08,type:"triangle",gain:.08});break;case"gameover":this.chirp(520,120,.35);break}}tone(E){const w=this.ctx,I=w.createOscillator(),u=w.createGain();I.type=E.type??"sine",I.frequency.value=E.freq,u.gain.value=E.gain??.08,I.connect(u).connect(w.destination),I.start(),u.gain.exponentialRampToValueAtTime(1e-4,w.currentTime+E.duration),I.stop(w.currentTime+E.duration+.02)}chirp(E,w,I){const u=this.ctx,e=u.createOscillator(),a=u.createGain();e.type="sawtooth",e.frequency.setValueAtTime(E,u.currentTime),e.frequency.exponentialRampToValueAtTime(120,u.currentTime+w/1e3),a.gain.value=I,e.connect(a).connect(u.destination),e.start(),a.gain.exponentialRampToValueAtTime(1e-4,u.currentTime+w/1e3),e.stop(u.currentTime+w/1e3+.05)}}class De{constructor(E){D(this,"engine");D(this,"renderer");D(this,"input");D(this,"audio");D(this,"world");D(this,"bodies",[]);D(this,"ground");D(this,"leftWall");D(this,"rightWall");D(this,"ceiling");D(this,"nextTierIndex",0);D(this,"dropperX",$.width/2);D(this,"score",0);D(this,"best",0);D(this,"comboCount",0);D(this,"lastMergeTime",0);D(this,"gameOver",!1);D(this,"overTimer",0);D(this,"paused",!1);D(this,"effects",[]);D(this,"hasDroppedFruit",!1);D(this,"state","RUNNING");D(this,"mergeCandidates",new Set);D(this,"MERGE_COOLDOWN",80);D(this,"VELOCITY_THRESHOLD",5);D(this,"OVERLAP_TOLERANCE",.15);this.canvas=E,this.engine=Y.Engine.create({gravity:{x:0,y:oe.gravityY,scale:.001}}),this.world=this.engine.world,this.renderer=new Oe(E),this.input=new Re(E,w=>this.renderer.canvasPxToWorldX(w),this.renderer),this.audio=new Be;try{this.best=Number(localStorage.getItem("best-score")||"0")||0}catch{}}async init(){await this.renderer.loadImages(),this.resetWorldBounds(),this.wireEvents(),this.rollNext(),this.updateHUD()}resetWorldBounds(){Y.Composite.clear(this.world,!1,!0),this.bodies=[],this.rebuildWorldBounds()}rebuildWorldBounds(){const E=$.width,w=$.height,I=$.wallThickness,u=E/2;this.ground=Y.Bodies.rectangle(u,w-I/2,E,I,{isStatic:!0,friction:.3,restitution:.1}),this.leftWall=Y.Bodies.rectangle(-I/2,w/2,I,w,{isStatic:!0,friction:.1}),this.rightWall=Y.Bodies.rectangle(E+I/2,w/2,I,w,{isStatic:!0,friction:.1}),this.ceiling=Y.Bodies.rectangle(u,-I/2,E,I,{isStatic:!0,isSensor:!0}),Y.World.add(this.world,[this.ground,this.leftWall,this.rightWall,this.ceiling])}wireEvents(){Y.Events.on(this.engine,"collisionStart",E=>{var w,I,u,e;for(const a of E.pairs){const n=a.bodyA,s=a.bodyB;((w=n.plugin)==null?void 0:w.tierIndex)!=null&&((I=s.plugin)==null?void 0:I.tierIndex)!=null?this.detectMergeCandidate(n,s):(((u=n.plugin)==null?void 0:u.tierIndex)!=null||((e=s.plugin)==null?void 0:e.tierIndex)!=null)&&this.audio.play("land")}}),Y.Events.on(this.engine,"collisionActive",E=>{var w,I;for(const u of E.pairs){const e=u.bodyA,a=u.bodyB;((w=e.plugin)==null?void 0:w.tierIndex)!=null&&((I=a.plugin)==null?void 0:I.tierIndex)!=null&&this.detectMergeCandidate(e,a)}})}getMergeKey(E,w){return E.id<w.id?`${E.id}-${w.id}`:`${w.id}-${E.id}`}detectMergeCandidate(E,w){if(!E.fruit||!w.fruit||E.fruit.tier!==w.fruit.tier||E.plugin.merging||w.plugin.merging)return;const I=performance.now();if(I-(E.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN||I-(w.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN)return;const e=Math.min(E.fruit.radius,w.fruit.radius)*this.OVERLAP_TOLERANCE,a=Math.hypot(E.position.x-w.position.x,E.position.y-w.position.y),n=Math.hypot(E.velocity.x-w.velocity.x,E.velocity.y-w.velocity.y);a<=E.fruit.radius+w.fruit.radius-e&&n<this.VELOCITY_THRESHOLD&&this.mergeCandidates.add(this.getMergeKey(E,w))}checkProximityForMerges(){for(const E of this.bodies){if(!E.fruit||E.plugin.merging)continue;const w=performance.now();if(!(w-(E.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN))for(const I of this.bodies){if(E===I||!I.fruit||I.plugin.merging||E.fruit.tier!==I.fruit.tier||w-(I.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN)continue;const e=Math.min(E.fruit.radius,I.fruit.radius)*this.OVERLAP_TOLERANCE,a=Math.hypot(E.position.x-I.position.x,E.position.y-I.position.y),n=Math.hypot(E.velocity.x-I.velocity.x,E.velocity.y-I.velocity.y),s=Math.max(E.fruit.radius,I.fruit.radius)+20;a<=s&&a<=E.fruit.radius+I.fruit.radius-e&&n<this.VELOCITY_THRESHOLD&&this.mergeCandidates.add(this.getMergeKey(E,I))}}}processMerges(){if(!this.mergeCandidates.size)return;const E=performance.now(),w=new Set;for(const I of this.mergeCandidates){const[u,e]=I.split("-").map(Number),a=this.bodies.find(o=>o.id===u),n=this.bodies.find(o=>o.id===e);if(!a||!n||!a.fruit||!n.fruit||a.fruit.tier!==n.fruit.tier||w.has(a.id)||w.has(n.id)||a.plugin.merging||n.plugin.merging||E-(a.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN||E-(n.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN)continue;const h=Math.min(a.fruit.radius,n.fruit.radius)*this.OVERLAP_TOLERANCE,l=Math.hypot(a.position.x-n.position.x,a.position.y-n.position.y),f=Math.hypot(a.velocity.x-n.velocity.x,a.velocity.y-n.velocity.y);l>a.fruit.radius+n.fruit.radius-h||f>=this.VELOCITY_THRESHOLD||(this.performMerge(a,n,E),w.add(a.id),w.add(n.id))}this.mergeCandidates.clear()}processChainMerges(){const E=performance.now(),w=new Map;for(const I of this.bodies){if(!I.fruit)continue;const u=I.fruit.tier;w.has(u)||w.set(u,[]),w.get(u).push(I)}for(const[I,u]of w)if(!(u.length<2)&&!(I>=q.length-1))for(let e=0;e<u.length;e++)for(let a=e+1;a<u.length;a++){const n=u[e],s=u[a];if(n.plugin.merging||s.plugin.merging||E-(n.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN||E-(s.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN)continue;const l=Math.min(n.fruit.radius,s.fruit.radius)*this.OVERLAP_TOLERANCE,f=Math.hypot(n.position.x-s.position.x,n.position.y-s.position.y),o=Math.hypot(n.velocity.x-s.velocity.x,n.velocity.y-s.velocity.y);if(!(f>n.fruit.radius+s.fruit.radius-l||o>=this.VELOCITY_THRESHOLD)){this.performMerge(n,s,E);break}}}performMerge(E,w,I){if(!E.fruit||!w.fruit||E.fruit.tier!==w.fruit.tier)return;const u=E.fruit.tier;if(u>=q.length-1)return;E.plugin.merging=w.plugin.merging=!0;const e=(E.position.x+w.position.x)/2,a=(E.position.y+w.position.y)/2,n=(E.velocity.x+w.velocity.x)/2,s=(E.velocity.y+w.velocity.y)/2;Y.World.remove(this.world,E),Y.World.remove(this.world,w),this.bodies=this.bodies.filter(f=>f!==E&&f!==w);const h=this.createFruit(u+1,e,a-6);Y.Body.setVelocity(h,{x:n,y:s}),h.fruit&&(h.fruit.lastMergeAt=I),this.audio.play("pop"),this.effects.push({x:e,y:a,t:0,duration:300}),I-this.lastMergeTime<=me.comboWindowMs?this.comboCount++:this.comboCount=1,this.lastMergeTime=I;const l=me.mergeBase*(u+1)*this.comboCount;if(this.score+=Math.floor(l),this.score>this.best){this.best=this.score;try{localStorage.setItem("best-score",String(this.best))}catch{}}this.updateHUD(),this.checkChainMerges(h,I)}checkChainMerges(E,w){if(E.fruit)for(const I of this.bodies){if(E===I||!I.fruit||E.fruit.tier!==I.fruit.tier||I.plugin.merging||w-(I.fruit.lastMergeAt||0)<this.MERGE_COOLDOWN)continue;const e=Math.min(E.fruit.radius,I.fruit.radius)*this.OVERLAP_TOLERANCE,a=Math.hypot(E.position.x-I.position.x,E.position.y-I.position.y),n=Math.hypot(E.velocity.x-I.velocity.x,E.velocity.y-I.velocity.y);if(a<=E.fruit.radius+I.fruit.radius-e&&n<this.VELOCITY_THRESHOLD){this.performMerge(E,I,w);break}}}createFruit(E,w,I){const u=q[E],e=Z(E),a=Y.Bodies.circle(w,I,e,{restitution:oe.restitution,friction:oe.friction,frictionAir:.002,mass:u.mass});return a.plugin={tierIndex:E},a.fruit={tier:E,radius:e,lastMergeAt:null},Y.World.add(this.world,a),this.bodies.push(a),a}rollNext(){const E=Math.min(4,q.length-2),w=Array.from({length:E+1},(a,n)=>1/(n+1)),I=w.reduce((a,n)=>a+n,0);let u=Math.random()*I,e=0;for(let a=0;a<w.length;a++)if(u-=w[a],u<=0){e=a;break}this.nextTierIndex=e,this.renderer.updatePreview(this.nextTierIndex)}updateHUD(){const E=document.getElementById("score");E.textContent=`Score: ${this.score}`;const w=document.getElementById("best");w.textContent=`Best: ${this.best}`}dropFruit(){if(this.gameOver||this.paused)return;const E=this.nextTierIndex,w=Z(E),I=w+4,u=$.width-w-4,e=Math.max(I,Math.min(u,this.dropperX));this.createFruit(E,e,$.spawnY),this.hasDroppedFruit=!0,this.rollNext()}updateGameOver(E){if(!this.hasDroppedFruit)return;let w=!1;for(const I of this.bodies)if(I.position.y-Z(I.plugin.tierIndex)<=$.gameOverLineY){w=!0;break}w?(this.overTimer+=E,this.overTimer>=1e3&&!this.gameOver&&this.triggerGameOver()):this.overTimer=0}triggerGameOver(){this.gameOver=!0,this.state="GAME_OVER",this.audio.play("gameover"),this.updateOverlayVisibility()}updateOverlayVisibility(){const E=document.getElementById("dialog");this.state==="GAME_OVER"?E.classList.remove("hidden"):E.classList.add("hidden")}restart(){this.gameOver=!1,this.overTimer=0,this.score=0,this.comboCount=0,this.lastMergeTime=0,this.hasDroppedFruit=!1,this.state="RUNNING",this.mergeCandidates.clear(),this.resetWorldBounds(),this.rollNext(),this.updateHUD(),this.updateOverlayVisibility()}setPaused(E){this.paused=E}setMuted(E){this.audio.setMuted(E)}getMuted(){return this.audio.isMuted}resizeCanvas(){this.renderer.resizeCanvas(),this.rebuildWorldBounds()}async start(){await this.init();let E;const w=()=>{clearTimeout(E),E=setTimeout(()=>this.renderer.resizeCanvas(),100)};this.renderer.resizeCanvas(),window.addEventListener("resize",w),window.addEventListener("orientationchange",w);let I=0,u=performance.now();const e=1e3/60,a=()=>{const n=performance.now();let s=n-u;u=n,I+=s,I>1e3&&(I=1e3);const h=this.input.getTouchWorldX();if(h!=null)this.dropperX=Math.max(Z(0)+4,Math.min($.width-Z(0)-4,h));else{const o=(this.input.right?1:0)-(this.input.left?1:0);this.dropperX=Math.max(Z(0)+4,Math.min($.width-Z(0)-4,this.dropperX+o*(s/1e3)*420))}if(this.input.consumeDrop()&&this.dropFruit(),!this.paused&&!this.gameOver){for(;I>=e;)Y.Engine.update(this.engine,e),I-=e;this.checkProximityForMerges(),this.processMerges(),this.processChainMerges(),this.updateGameOver(s)}this.effects.forEach(f=>f.t+=s),this.effects=this.effects.filter(f=>f.t<f.duration),this.renderer.clear();const l=this.bodies.map(f=>({id:f.id,x:f.position.x,y:f.position.y,r:Z(f.plugin.tierIndex),angle:f.angle,tierIndex:f.plugin.tierIndex}));this.renderer.drawWorldBounds(),this.renderer.drawGameOverLine(),this.renderer.drawBodies(l),this.renderer.drawDropper(this.dropperX,this.nextTierIndex),this.renderer.drawEffects(this.effects),requestAnimationFrame(a)};requestAnimationFrame(a)}}const Ve=document.getElementById("game"),Se=document.getElementById("btn-pause"),We=document.getElementById("btn-restart"),ke=document.getElementById("btn-dialog-restart"),le=document.getElementById("btn-sound"),j=new De(Ve);let ne=!1;Se.addEventListener("click",()=>{ne=!ne,j.setPaused(ne),Se.textContent=ne?"▶":"⏸"});We.addEventListener("click",()=>{fe()});ke.addEventListener("click",()=>{fe()});let _=!1;try{_=localStorage.getItem("sound-muted")==="1"}catch{}le.textContent=_?"🔈":"🔊";le.addEventListener("click",()=>{_=!_,j.setMuted(_),le.textContent=_?"🔈":"🔊"});window.addEventListener("pointerdown",()=>{var k,E;(E=(k=j.audio)==null?void 0:k.unlock)==null||E.call(k)},{once:!0,passive:!0});window.addEventListener("keydown",k=>{k.code==="Space"&&k.preventDefault()},{passive:!1});function fe(){j.resizeCanvas(),j.init().then(()=>{j.restart(),j.start()})}document.addEventListener("DOMContentLoaded",()=>{fe()});
